{"version":3,"sources":["webpack://Darkmode/webpack/universalModuleDefinition","webpack://Darkmode/webpack/bootstrap","webpack://Darkmode/./node_modules/color-convert/conversions.js","webpack://Darkmode/./node_modules/color-convert/index.js","webpack://Darkmode/./node_modules/color-convert/node_modules/color-name/index.js","webpack://Darkmode/./node_modules/color-convert/route.js","webpack://Darkmode/./node_modules/color-name/index.js","webpack://Darkmode/./node_modules/color-string/index.js","webpack://Darkmode/./node_modules/color/index.js","webpack://Darkmode/./node_modules/is-arrayish/index.js","webpack://Darkmode/./node_modules/simple-swizzle/index.js","webpack://Darkmode/./src/common/bgNodeStack.js","webpack://Darkmode/./src/common/constant.js","webpack://Darkmode/./src/common/cssUtils.js","webpack://Darkmode/./src/common/domUtils.js","webpack://Darkmode/./src/common/sdk.js","webpack://Darkmode/./src/common/textNodeQueue.js","webpack://Darkmode/./src/darkmode.js"],"names":["BgNodeStack","config","prefix","_config","_prefix","el","cssKV","className","_idx","classList","add","_stack","unshift","updated","delayBgJudge","callback","rect","getBoundingClientRect","idxStack","forEach","item","i","bgRect","top","bottom","left","right","length","splice","shift","nodes","Array","prototype","some","call","node","contains","MEDIA_QUERY","CLASS_PREFIX","HTML_CLASS","RANDOM","Date","Math","round","random","COLORATTR","BGCOLORATTR","ORIGINAL_COLORATTR","ORIGINAL_BGCOLORATTR","BGIMAGEATTR","TEXTCOLOR","DEFAULT_DARK_BGCOLOR","DEFAULT_LIGHT_BGCOLOR","DEFAULT_DARK_BGCOLOR_BRIGHTNESS","LIMIT_LOW_BGCOLOR_BRIGHTNESS","PAGE_HEIGHT","window","getInnerHeight","innerHeight","document","documentElement","clientHeight","TABLE_NAME","UA","navigator","userAgent","IS_PC","test","CssUtils","key","val","mode","css","isFirstPageStyle","styleKey","_otherPageStyle","_firstPageStyle","isFinish","style","head","insertAdjacentHTML","getChildrenAndIt","dom","concat","querySelectorAll","hasTextNode","cnt","childNodes","nodeType","nodeValue","replace","tableClassObj","hasTableClass","color","DomUtils","_nodes","res","_delayNodes","container","push","_firstPageNodes","visibility","ColorName","windowtext","colorNameReg","RegExp","Object","keys","join","SDK","tnQueue","bgStack","cssUtils","_tnQueue","_bgStack","_cssUtils","options","hsl","array","alpha","whiteColorBrightness","limitBright","limitLowTextBright","LimitOffsetBrightness","rgb","perceivedBrightness","newColor","extStyle","isBgColor","getAttribute","removeAttribute","Color","min","ratio","hasInlineColor","parentTextColor","parentBgColorStr","ret","_adjustBrightness","isTextColor","parentElementBgColorStr","genCssKV","isBorderColor","parentElementBgColor","parentElementBgColorRgb","parentElementBgColorHSL","parentElementBgColorAlpha","parentElementBGPerceivedBrightness","parentElementBGWithOpacityPerceivedBrightness","adjustTextBrightnessByLimitBrightness","rgbArray","limitLowBright","relativeBrightnessRatio","newTextR","newTextG","newTextB","offsetPerceivedBrightness","abs","tmpRgb","tmpPerceivedBrightness","nodeName","whitelist","tagName","indexOf","styles","isTable","hasInlineBackground","hasInlineBackgroundImage","elBackgroundPositionAttr","elBackgroundSizeAttr","cssKVList","cssText","split","map","cssStr","splitIdx","slice","toLowerCase","filter","value","sort","key1","key2","toString","oldValue","cssChange","importantReg","match","colorReg","isGradient","mixColor","colors","retColor","nextColor","pop","mix","gradientColors","gradientMixColor","attrName","originalAttrName","retColorStr","setAttribute","SVGElement","isBackgroundAttr","isBorderImageAttr","imgBgColor","imgBgCover","matches","newValue","newBackgroundPositionValue","newBackgroundSizeValue","tmpCssKvStr","textColor","genCss","TextNodeQueue","_queue","idx","classReg","error","needJudgeFirstPage","domUtils","sdk","mql","switchToDarkmode","mqlObj","opt","type","force","get","addCss","convert","addFirstPageNode","writeStyle","showFirstPageNodes","text","bg","len","delay","e","console","run","init","JSON","parse","stringify","assign","toUpperCase","matchMedia","addListener","set","convertBg","update"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;QCVA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;AClFA;AACA,kBAAkB,mBAAO,CAAC,iFAAY;;AAEtC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,OAAO,2BAA2B;AAClC,OAAO,2BAA2B;AAClC,OAAO,2BAA2B;AAClC,OAAO,2BAA2B;AAClC,QAAQ,4BAA4B;AACpC,OAAO,2BAA2B;AAClC,OAAO,2BAA2B;AAClC,OAAO,2BAA2B;AAClC,OAAO,6BAA6B;AACpC,WAAW,iCAAiC;AAC5C,UAAU,gCAAgC;AAC1C,WAAW,iCAAiC;AAC5C,OAAO,qCAAqC;AAC5C,SAAS,2CAA2C;AACpD,QAAQ;AACR;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,qDAAqD,gBAAgB;AACrE,mDAAmD,cAAc;AACjE;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA,EAAE;AACF;AACA,EAAE;AACF;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,EAAE;AACF;AACA,EAAE;AACF;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA;;AAEA;;AAEA;AACA,gBAAgB,OAAO;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,uBAAuB;;AAEvB;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,OAAO,QAAQ;AAC/B,gBAAgB,OAAO,QAAQ;AAC/B,iBAAiB,OAAO,OAAO;AAC/B,iBAAiB,OAAO,OAAO;AAC/B,gBAAgB,QAAQ,OAAO;AAC/B,gBAAgB,QAAQ,OAAO;AAC/B;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,sEAAsE;;AAEtE;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,sBAAsB;AACtB;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,+CAA+C,EAAE,UAAU,EAAE;AAC7D;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA;AACA,EAAE;AACF;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,eAAe,aAAa,aAAa;AACzC;AACA,eAAe,aAAa,aAAa;AACzC;AACA,eAAe,aAAa,aAAa;AACzC;AACA,eAAe,aAAa,aAAa;AACzC;AACA,eAAe,aAAa,aAAa;AACzC;AACA,eAAe,aAAa;AAC5B;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;;;;;;ACn2BA,kBAAkB,mBAAO,CAAC,kEAAe;AACzC,YAAY,mBAAO,CAAC,sDAAS;;AAE7B;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA,kCAAkC;AAClC;AACA;AACA,uCAAuC,SAAS;AAChD;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA,wDAAwD,uCAAuC;AAC/F,sDAAsD,qCAAqC;;AAE3F;AACA;;AAEA;AACA;;AAEA;AACA;AACA,EAAE;AACF,CAAC;;AAED;;;;;;;;;;;;;AC7EY;;AAEZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACvJA,kBAAkB,mBAAO,CAAC,kEAAe;;AAEzC;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,qCAAqC,SAAS;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,yBAAyB;;AAEzB;;AAEA;AACA;AACA;;AAEA,yCAAyC,SAAS;AAClD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,qCAAqC,SAAS;AAC9C;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;;;;;AC/FY;;AAEZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACvJA;AACA,iBAAiB,mBAAO,CAAC,sDAAY;AACrC,cAAc,mBAAO,CAAC,8DAAgB;;AAEtC;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,SAAS;AACT;;AAEA;AACA;AACA;AACA;;AAEA,yBAAyB,IAAI;AAC7B,wBAAwB,EAAE,WAAW,EAAE;AACvC;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,aAAa,OAAO;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA;;AAEA,aAAa,OAAO;AACpB;AACA;;AAEA;AACA;AACA;AACA,EAAE;AACF,aAAa,OAAO;AACpB;AACA;;AAEA;AACA;AACA;AACA,EAAE;AACF,aAAa,OAAO;AACpB;AACA;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA,EAAE;AACF;AACA;;AAEA,YAAY,OAAO;AACnB;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;ACzOa;;AAEb,kBAAkB,mBAAO,CAAC,0DAAc;AACxC,cAAc,mBAAO,CAAC,4DAAe;;AAErC;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,CAAC;;AAED;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,mBAAmB;AACnB;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,aAAa,mBAAmB;AAChC;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,aAAa,cAAc;AAC3B;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;;AAEA,iBAAiB,cAAc;AAC/B;AACA;;AAEA;AACA;AACA;;AAEA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,EAAE;;AAEF;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA,EAAE;;AAEF;AACA;AACA;AACA;;AAEA,qEAAqE,kCAAkC,EAAE;;AAEzG;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,EAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA,EAAE;;AAEF;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;;AAEA;AACA,iBAAiB,gBAAgB;AACjC;AACA;AACA;;AAEA;AACA,EAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA,EAAE;;AAEF;AACA;AACA,iBAAiB,OAAO;AACxB;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA,EAAE;;AAEF;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,EAAE;;AAEF;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,gBAAgB,YAAY;AAC5B;AACA;AAC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","file":"darkmode.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"Darkmode\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Darkmode\"] = factory();\n\telse\n\t\troot[\"Darkmode\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/darkmode.js\");\n","/* MIT license */\nvar cssKeywords = require('color-name');\n\n// NOTE: conversions should only return primitive values (i.e. arrays, or\n//       values that give correct `typeof` results).\n//       do not use box values types (i.e. Number(), String(), etc.)\n\nvar reverseKeywords = {};\nfor (var key in cssKeywords) {\n\tif (cssKeywords.hasOwnProperty(key)) {\n\t\treverseKeywords[cssKeywords[key]] = key;\n\t}\n}\n\nvar convert = module.exports = {\n\trgb: {channels: 3, labels: 'rgb'},\n\thsl: {channels: 3, labels: 'hsl'},\n\thsv: {channels: 3, labels: 'hsv'},\n\thwb: {channels: 3, labels: 'hwb'},\n\tcmyk: {channels: 4, labels: 'cmyk'},\n\txyz: {channels: 3, labels: 'xyz'},\n\tlab: {channels: 3, labels: 'lab'},\n\tlch: {channels: 3, labels: 'lch'},\n\thex: {channels: 1, labels: ['hex']},\n\tkeyword: {channels: 1, labels: ['keyword']},\n\tansi16: {channels: 1, labels: ['ansi16']},\n\tansi256: {channels: 1, labels: ['ansi256']},\n\thcg: {channels: 3, labels: ['h', 'c', 'g']},\n\tapple: {channels: 3, labels: ['r16', 'g16', 'b16']},\n\tgray: {channels: 1, labels: ['gray']}\n};\n\n// hide .channels and .labels properties\nfor (var model in convert) {\n\tif (convert.hasOwnProperty(model)) {\n\t\tif (!('channels' in convert[model])) {\n\t\t\tthrow new Error('missing channels property: ' + model);\n\t\t}\n\n\t\tif (!('labels' in convert[model])) {\n\t\t\tthrow new Error('missing channel labels property: ' + model);\n\t\t}\n\n\t\tif (convert[model].labels.length !== convert[model].channels) {\n\t\t\tthrow new Error('channel and label counts mismatch: ' + model);\n\t\t}\n\n\t\tvar channels = convert[model].channels;\n\t\tvar labels = convert[model].labels;\n\t\tdelete convert[model].channels;\n\t\tdelete convert[model].labels;\n\t\tObject.defineProperty(convert[model], 'channels', {value: channels});\n\t\tObject.defineProperty(convert[model], 'labels', {value: labels});\n\t}\n}\n\nconvert.rgb.hsl = function (rgb) {\n\tvar r = rgb[0] / 255;\n\tvar g = rgb[1] / 255;\n\tvar b = rgb[2] / 255;\n\tvar min = Math.min(r, g, b);\n\tvar max = Math.max(r, g, b);\n\tvar delta = max - min;\n\tvar h;\n\tvar s;\n\tvar l;\n\n\tif (max === min) {\n\t\th = 0;\n\t} else if (r === max) {\n\t\th = (g - b) / delta;\n\t} else if (g === max) {\n\t\th = 2 + (b - r) / delta;\n\t} else if (b === max) {\n\t\th = 4 + (r - g) / delta;\n\t}\n\n\th = Math.min(h * 60, 360);\n\n\tif (h < 0) {\n\t\th += 360;\n\t}\n\n\tl = (min + max) / 2;\n\n\tif (max === min) {\n\t\ts = 0;\n\t} else if (l <= 0.5) {\n\t\ts = delta / (max + min);\n\t} else {\n\t\ts = delta / (2 - max - min);\n\t}\n\n\treturn [h, s * 100, l * 100];\n};\n\nconvert.rgb.hsv = function (rgb) {\n\tvar rdif;\n\tvar gdif;\n\tvar bdif;\n\tvar h;\n\tvar s;\n\n\tvar r = rgb[0] / 255;\n\tvar g = rgb[1] / 255;\n\tvar b = rgb[2] / 255;\n\tvar v = Math.max(r, g, b);\n\tvar diff = v - Math.min(r, g, b);\n\tvar diffc = function (c) {\n\t\treturn (v - c) / 6 / diff + 1 / 2;\n\t};\n\n\tif (diff === 0) {\n\t\th = s = 0;\n\t} else {\n\t\ts = diff / v;\n\t\trdif = diffc(r);\n\t\tgdif = diffc(g);\n\t\tbdif = diffc(b);\n\n\t\tif (r === v) {\n\t\t\th = bdif - gdif;\n\t\t} else if (g === v) {\n\t\t\th = (1 / 3) + rdif - bdif;\n\t\t} else if (b === v) {\n\t\t\th = (2 / 3) + gdif - rdif;\n\t\t}\n\t\tif (h < 0) {\n\t\t\th += 1;\n\t\t} else if (h > 1) {\n\t\t\th -= 1;\n\t\t}\n\t}\n\n\treturn [\n\t\th * 360,\n\t\ts * 100,\n\t\tv * 100\n\t];\n};\n\nconvert.rgb.hwb = function (rgb) {\n\tvar r = rgb[0];\n\tvar g = rgb[1];\n\tvar b = rgb[2];\n\tvar h = convert.rgb.hsl(rgb)[0];\n\tvar w = 1 / 255 * Math.min(r, Math.min(g, b));\n\n\tb = 1 - 1 / 255 * Math.max(r, Math.max(g, b));\n\n\treturn [h, w * 100, b * 100];\n};\n\nconvert.rgb.cmyk = function (rgb) {\n\tvar r = rgb[0] / 255;\n\tvar g = rgb[1] / 255;\n\tvar b = rgb[2] / 255;\n\tvar c;\n\tvar m;\n\tvar y;\n\tvar k;\n\n\tk = Math.min(1 - r, 1 - g, 1 - b);\n\tc = (1 - r - k) / (1 - k) || 0;\n\tm = (1 - g - k) / (1 - k) || 0;\n\ty = (1 - b - k) / (1 - k) || 0;\n\n\treturn [c * 100, m * 100, y * 100, k * 100];\n};\n\n/**\n * See https://en.m.wikipedia.org/wiki/Euclidean_distance#Squared_Euclidean_distance\n * */\nfunction comparativeDistance(x, y) {\n\treturn (\n\t\tMath.pow(x[0] - y[0], 2) +\n\t\tMath.pow(x[1] - y[1], 2) +\n\t\tMath.pow(x[2] - y[2], 2)\n\t);\n}\n\nconvert.rgb.keyword = function (rgb) {\n\tvar reversed = reverseKeywords[rgb];\n\tif (reversed) {\n\t\treturn reversed;\n\t}\n\n\tvar currentClosestDistance = Infinity;\n\tvar currentClosestKeyword;\n\n\tfor (var keyword in cssKeywords) {\n\t\tif (cssKeywords.hasOwnProperty(keyword)) {\n\t\t\tvar value = cssKeywords[keyword];\n\n\t\t\t// Compute comparative distance\n\t\t\tvar distance = comparativeDistance(rgb, value);\n\n\t\t\t// Check if its less, if so set as closest\n\t\t\tif (distance < currentClosestDistance) {\n\t\t\t\tcurrentClosestDistance = distance;\n\t\t\t\tcurrentClosestKeyword = keyword;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn currentClosestKeyword;\n};\n\nconvert.keyword.rgb = function (keyword) {\n\treturn cssKeywords[keyword];\n};\n\nconvert.rgb.xyz = function (rgb) {\n\tvar r = rgb[0] / 255;\n\tvar g = rgb[1] / 255;\n\tvar b = rgb[2] / 255;\n\n\t// assume sRGB\n\tr = r > 0.04045 ? Math.pow(((r + 0.055) / 1.055), 2.4) : (r / 12.92);\n\tg = g > 0.04045 ? Math.pow(((g + 0.055) / 1.055), 2.4) : (g / 12.92);\n\tb = b > 0.04045 ? Math.pow(((b + 0.055) / 1.055), 2.4) : (b / 12.92);\n\n\tvar x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);\n\tvar y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);\n\tvar z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);\n\n\treturn [x * 100, y * 100, z * 100];\n};\n\nconvert.rgb.lab = function (rgb) {\n\tvar xyz = convert.rgb.xyz(rgb);\n\tvar x = xyz[0];\n\tvar y = xyz[1];\n\tvar z = xyz[2];\n\tvar l;\n\tvar a;\n\tvar b;\n\n\tx /= 95.047;\n\ty /= 100;\n\tz /= 108.883;\n\n\tx = x > 0.008856 ? Math.pow(x, 1 / 3) : (7.787 * x) + (16 / 116);\n\ty = y > 0.008856 ? Math.pow(y, 1 / 3) : (7.787 * y) + (16 / 116);\n\tz = z > 0.008856 ? Math.pow(z, 1 / 3) : (7.787 * z) + (16 / 116);\n\n\tl = (116 * y) - 16;\n\ta = 500 * (x - y);\n\tb = 200 * (y - z);\n\n\treturn [l, a, b];\n};\n\nconvert.hsl.rgb = function (hsl) {\n\tvar h = hsl[0] / 360;\n\tvar s = hsl[1] / 100;\n\tvar l = hsl[2] / 100;\n\tvar t1;\n\tvar t2;\n\tvar t3;\n\tvar rgb;\n\tvar val;\n\n\tif (s === 0) {\n\t\tval = l * 255;\n\t\treturn [val, val, val];\n\t}\n\n\tif (l < 0.5) {\n\t\tt2 = l * (1 + s);\n\t} else {\n\t\tt2 = l + s - l * s;\n\t}\n\n\tt1 = 2 * l - t2;\n\n\trgb = [0, 0, 0];\n\tfor (var i = 0; i < 3; i++) {\n\t\tt3 = h + 1 / 3 * -(i - 1);\n\t\tif (t3 < 0) {\n\t\t\tt3++;\n\t\t}\n\t\tif (t3 > 1) {\n\t\t\tt3--;\n\t\t}\n\n\t\tif (6 * t3 < 1) {\n\t\t\tval = t1 + (t2 - t1) * 6 * t3;\n\t\t} else if (2 * t3 < 1) {\n\t\t\tval = t2;\n\t\t} else if (3 * t3 < 2) {\n\t\t\tval = t1 + (t2 - t1) * (2 / 3 - t3) * 6;\n\t\t} else {\n\t\t\tval = t1;\n\t\t}\n\n\t\trgb[i] = val * 255;\n\t}\n\n\treturn rgb;\n};\n\nconvert.hsl.hsv = function (hsl) {\n\tvar h = hsl[0];\n\tvar s = hsl[1] / 100;\n\tvar l = hsl[2] / 100;\n\tvar smin = s;\n\tvar lmin = Math.max(l, 0.01);\n\tvar sv;\n\tvar v;\n\n\tl *= 2;\n\ts *= (l <= 1) ? l : 2 - l;\n\tsmin *= lmin <= 1 ? lmin : 2 - lmin;\n\tv = (l + s) / 2;\n\tsv = l === 0 ? (2 * smin) / (lmin + smin) : (2 * s) / (l + s);\n\n\treturn [h, sv * 100, v * 100];\n};\n\nconvert.hsv.rgb = function (hsv) {\n\tvar h = hsv[0] / 60;\n\tvar s = hsv[1] / 100;\n\tvar v = hsv[2] / 100;\n\tvar hi = Math.floor(h) % 6;\n\n\tvar f = h - Math.floor(h);\n\tvar p = 255 * v * (1 - s);\n\tvar q = 255 * v * (1 - (s * f));\n\tvar t = 255 * v * (1 - (s * (1 - f)));\n\tv *= 255;\n\n\tswitch (hi) {\n\t\tcase 0:\n\t\t\treturn [v, t, p];\n\t\tcase 1:\n\t\t\treturn [q, v, p];\n\t\tcase 2:\n\t\t\treturn [p, v, t];\n\t\tcase 3:\n\t\t\treturn [p, q, v];\n\t\tcase 4:\n\t\t\treturn [t, p, v];\n\t\tcase 5:\n\t\t\treturn [v, p, q];\n\t}\n};\n\nconvert.hsv.hsl = function (hsv) {\n\tvar h = hsv[0];\n\tvar s = hsv[1] / 100;\n\tvar v = hsv[2] / 100;\n\tvar vmin = Math.max(v, 0.01);\n\tvar lmin;\n\tvar sl;\n\tvar l;\n\n\tl = (2 - s) * v;\n\tlmin = (2 - s) * vmin;\n\tsl = s * vmin;\n\tsl /= (lmin <= 1) ? lmin : 2 - lmin;\n\tsl = sl || 0;\n\tl /= 2;\n\n\treturn [h, sl * 100, l * 100];\n};\n\n// http://dev.w3.org/csswg/css-color/#hwb-to-rgb\nconvert.hwb.rgb = function (hwb) {\n\tvar h = hwb[0] / 360;\n\tvar wh = hwb[1] / 100;\n\tvar bl = hwb[2] / 100;\n\tvar ratio = wh + bl;\n\tvar i;\n\tvar v;\n\tvar f;\n\tvar n;\n\n\t// wh + bl cant be > 1\n\tif (ratio > 1) {\n\t\twh /= ratio;\n\t\tbl /= ratio;\n\t}\n\n\ti = Math.floor(6 * h);\n\tv = 1 - bl;\n\tf = 6 * h - i;\n\n\tif ((i & 0x01) !== 0) {\n\t\tf = 1 - f;\n\t}\n\n\tn = wh + f * (v - wh); // linear interpolation\n\n\tvar r;\n\tvar g;\n\tvar b;\n\tswitch (i) {\n\t\tdefault:\n\t\tcase 6:\n\t\tcase 0: r = v; g = n; b = wh; break;\n\t\tcase 1: r = n; g = v; b = wh; break;\n\t\tcase 2: r = wh; g = v; b = n; break;\n\t\tcase 3: r = wh; g = n; b = v; break;\n\t\tcase 4: r = n; g = wh; b = v; break;\n\t\tcase 5: r = v; g = wh; b = n; break;\n\t}\n\n\treturn [r * 255, g * 255, b * 255];\n};\n\nconvert.cmyk.rgb = function (cmyk) {\n\tvar c = cmyk[0] / 100;\n\tvar m = cmyk[1] / 100;\n\tvar y = cmyk[2] / 100;\n\tvar k = cmyk[3] / 100;\n\tvar r;\n\tvar g;\n\tvar b;\n\n\tr = 1 - Math.min(1, c * (1 - k) + k);\n\tg = 1 - Math.min(1, m * (1 - k) + k);\n\tb = 1 - Math.min(1, y * (1 - k) + k);\n\n\treturn [r * 255, g * 255, b * 255];\n};\n\nconvert.xyz.rgb = function (xyz) {\n\tvar x = xyz[0] / 100;\n\tvar y = xyz[1] / 100;\n\tvar z = xyz[2] / 100;\n\tvar r;\n\tvar g;\n\tvar b;\n\n\tr = (x * 3.2406) + (y * -1.5372) + (z * -0.4986);\n\tg = (x * -0.9689) + (y * 1.8758) + (z * 0.0415);\n\tb = (x * 0.0557) + (y * -0.2040) + (z * 1.0570);\n\n\t// assume sRGB\n\tr = r > 0.0031308\n\t\t? ((1.055 * Math.pow(r, 1.0 / 2.4)) - 0.055)\n\t\t: r * 12.92;\n\n\tg = g > 0.0031308\n\t\t? ((1.055 * Math.pow(g, 1.0 / 2.4)) - 0.055)\n\t\t: g * 12.92;\n\n\tb = b > 0.0031308\n\t\t? ((1.055 * Math.pow(b, 1.0 / 2.4)) - 0.055)\n\t\t: b * 12.92;\n\n\tr = Math.min(Math.max(0, r), 1);\n\tg = Math.min(Math.max(0, g), 1);\n\tb = Math.min(Math.max(0, b), 1);\n\n\treturn [r * 255, g * 255, b * 255];\n};\n\nconvert.xyz.lab = function (xyz) {\n\tvar x = xyz[0];\n\tvar y = xyz[1];\n\tvar z = xyz[2];\n\tvar l;\n\tvar a;\n\tvar b;\n\n\tx /= 95.047;\n\ty /= 100;\n\tz /= 108.883;\n\n\tx = x > 0.008856 ? Math.pow(x, 1 / 3) : (7.787 * x) + (16 / 116);\n\ty = y > 0.008856 ? Math.pow(y, 1 / 3) : (7.787 * y) + (16 / 116);\n\tz = z > 0.008856 ? Math.pow(z, 1 / 3) : (7.787 * z) + (16 / 116);\n\n\tl = (116 * y) - 16;\n\ta = 500 * (x - y);\n\tb = 200 * (y - z);\n\n\treturn [l, a, b];\n};\n\nconvert.lab.xyz = function (lab) {\n\tvar l = lab[0];\n\tvar a = lab[1];\n\tvar b = lab[2];\n\tvar x;\n\tvar y;\n\tvar z;\n\n\ty = (l + 16) / 116;\n\tx = a / 500 + y;\n\tz = y - b / 200;\n\n\tvar y2 = Math.pow(y, 3);\n\tvar x2 = Math.pow(x, 3);\n\tvar z2 = Math.pow(z, 3);\n\ty = y2 > 0.008856 ? y2 : (y - 16 / 116) / 7.787;\n\tx = x2 > 0.008856 ? x2 : (x - 16 / 116) / 7.787;\n\tz = z2 > 0.008856 ? z2 : (z - 16 / 116) / 7.787;\n\n\tx *= 95.047;\n\ty *= 100;\n\tz *= 108.883;\n\n\treturn [x, y, z];\n};\n\nconvert.lab.lch = function (lab) {\n\tvar l = lab[0];\n\tvar a = lab[1];\n\tvar b = lab[2];\n\tvar hr;\n\tvar h;\n\tvar c;\n\n\thr = Math.atan2(b, a);\n\th = hr * 360 / 2 / Math.PI;\n\n\tif (h < 0) {\n\t\th += 360;\n\t}\n\n\tc = Math.sqrt(a * a + b * b);\n\n\treturn [l, c, h];\n};\n\nconvert.lch.lab = function (lch) {\n\tvar l = lch[0];\n\tvar c = lch[1];\n\tvar h = lch[2];\n\tvar a;\n\tvar b;\n\tvar hr;\n\n\thr = h / 360 * 2 * Math.PI;\n\ta = c * Math.cos(hr);\n\tb = c * Math.sin(hr);\n\n\treturn [l, a, b];\n};\n\nconvert.rgb.ansi16 = function (args) {\n\tvar r = args[0];\n\tvar g = args[1];\n\tvar b = args[2];\n\tvar value = 1 in arguments ? arguments[1] : convert.rgb.hsv(args)[2]; // hsv -> ansi16 optimization\n\n\tvalue = Math.round(value / 50);\n\n\tif (value === 0) {\n\t\treturn 30;\n\t}\n\n\tvar ansi = 30\n\t\t+ ((Math.round(b / 255) << 2)\n\t\t| (Math.round(g / 255) << 1)\n\t\t| Math.round(r / 255));\n\n\tif (value === 2) {\n\t\tansi += 60;\n\t}\n\n\treturn ansi;\n};\n\nconvert.hsv.ansi16 = function (args) {\n\t// optimization here; we already know the value and don't need to get\n\t// it converted for us.\n\treturn convert.rgb.ansi16(convert.hsv.rgb(args), args[2]);\n};\n\nconvert.rgb.ansi256 = function (args) {\n\tvar r = args[0];\n\tvar g = args[1];\n\tvar b = args[2];\n\n\t// we use the extended greyscale palette here, with the exception of\n\t// black and white. normal palette only has 4 greyscale shades.\n\tif (r === g && g === b) {\n\t\tif (r < 8) {\n\t\t\treturn 16;\n\t\t}\n\n\t\tif (r > 248) {\n\t\t\treturn 231;\n\t\t}\n\n\t\treturn Math.round(((r - 8) / 247) * 24) + 232;\n\t}\n\n\tvar ansi = 16\n\t\t+ (36 * Math.round(r / 255 * 5))\n\t\t+ (6 * Math.round(g / 255 * 5))\n\t\t+ Math.round(b / 255 * 5);\n\n\treturn ansi;\n};\n\nconvert.ansi16.rgb = function (args) {\n\tvar color = args % 10;\n\n\t// handle greyscale\n\tif (color === 0 || color === 7) {\n\t\tif (args > 50) {\n\t\t\tcolor += 3.5;\n\t\t}\n\n\t\tcolor = color / 10.5 * 255;\n\n\t\treturn [color, color, color];\n\t}\n\n\tvar mult = (~~(args > 50) + 1) * 0.5;\n\tvar r = ((color & 1) * mult) * 255;\n\tvar g = (((color >> 1) & 1) * mult) * 255;\n\tvar b = (((color >> 2) & 1) * mult) * 255;\n\n\treturn [r, g, b];\n};\n\nconvert.ansi256.rgb = function (args) {\n\t// handle greyscale\n\tif (args >= 232) {\n\t\tvar c = (args - 232) * 10 + 8;\n\t\treturn [c, c, c];\n\t}\n\n\targs -= 16;\n\n\tvar rem;\n\tvar r = Math.floor(args / 36) / 5 * 255;\n\tvar g = Math.floor((rem = args % 36) / 6) / 5 * 255;\n\tvar b = (rem % 6) / 5 * 255;\n\n\treturn [r, g, b];\n};\n\nconvert.rgb.hex = function (args) {\n\tvar integer = ((Math.round(args[0]) & 0xFF) << 16)\n\t\t+ ((Math.round(args[1]) & 0xFF) << 8)\n\t\t+ (Math.round(args[2]) & 0xFF);\n\n\tvar string = integer.toString(16).toUpperCase();\n\treturn '000000'.substring(string.length) + string;\n};\n\nconvert.hex.rgb = function (args) {\n\tvar match = args.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);\n\tif (!match) {\n\t\treturn [0, 0, 0];\n\t}\n\n\tvar colorString = match[0];\n\n\tif (match[0].length === 3) {\n\t\tcolorString = colorString.split('').map(function (char) {\n\t\t\treturn char + char;\n\t\t}).join('');\n\t}\n\n\tvar integer = parseInt(colorString, 16);\n\tvar r = (integer >> 16) & 0xFF;\n\tvar g = (integer >> 8) & 0xFF;\n\tvar b = integer & 0xFF;\n\n\treturn [r, g, b];\n};\n\nconvert.rgb.hcg = function (rgb) {\n\tvar r = rgb[0] / 255;\n\tvar g = rgb[1] / 255;\n\tvar b = rgb[2] / 255;\n\tvar max = Math.max(Math.max(r, g), b);\n\tvar min = Math.min(Math.min(r, g), b);\n\tvar chroma = (max - min);\n\tvar grayscale;\n\tvar hue;\n\n\tif (chroma < 1) {\n\t\tgrayscale = min / (1 - chroma);\n\t} else {\n\t\tgrayscale = 0;\n\t}\n\n\tif (chroma <= 0) {\n\t\thue = 0;\n\t} else\n\tif (max === r) {\n\t\thue = ((g - b) / chroma) % 6;\n\t} else\n\tif (max === g) {\n\t\thue = 2 + (b - r) / chroma;\n\t} else {\n\t\thue = 4 + (r - g) / chroma + 4;\n\t}\n\n\thue /= 6;\n\thue %= 1;\n\n\treturn [hue * 360, chroma * 100, grayscale * 100];\n};\n\nconvert.hsl.hcg = function (hsl) {\n\tvar s = hsl[1] / 100;\n\tvar l = hsl[2] / 100;\n\tvar c = 1;\n\tvar f = 0;\n\n\tif (l < 0.5) {\n\t\tc = 2.0 * s * l;\n\t} else {\n\t\tc = 2.0 * s * (1.0 - l);\n\t}\n\n\tif (c < 1.0) {\n\t\tf = (l - 0.5 * c) / (1.0 - c);\n\t}\n\n\treturn [hsl[0], c * 100, f * 100];\n};\n\nconvert.hsv.hcg = function (hsv) {\n\tvar s = hsv[1] / 100;\n\tvar v = hsv[2] / 100;\n\n\tvar c = s * v;\n\tvar f = 0;\n\n\tif (c < 1.0) {\n\t\tf = (v - c) / (1 - c);\n\t}\n\n\treturn [hsv[0], c * 100, f * 100];\n};\n\nconvert.hcg.rgb = function (hcg) {\n\tvar h = hcg[0] / 360;\n\tvar c = hcg[1] / 100;\n\tvar g = hcg[2] / 100;\n\n\tif (c === 0.0) {\n\t\treturn [g * 255, g * 255, g * 255];\n\t}\n\n\tvar pure = [0, 0, 0];\n\tvar hi = (h % 1) * 6;\n\tvar v = hi % 1;\n\tvar w = 1 - v;\n\tvar mg = 0;\n\n\tswitch (Math.floor(hi)) {\n\t\tcase 0:\n\t\t\tpure[0] = 1; pure[1] = v; pure[2] = 0; break;\n\t\tcase 1:\n\t\t\tpure[0] = w; pure[1] = 1; pure[2] = 0; break;\n\t\tcase 2:\n\t\t\tpure[0] = 0; pure[1] = 1; pure[2] = v; break;\n\t\tcase 3:\n\t\t\tpure[0] = 0; pure[1] = w; pure[2] = 1; break;\n\t\tcase 4:\n\t\t\tpure[0] = v; pure[1] = 0; pure[2] = 1; break;\n\t\tdefault:\n\t\t\tpure[0] = 1; pure[1] = 0; pure[2] = w;\n\t}\n\n\tmg = (1.0 - c) * g;\n\n\treturn [\n\t\t(c * pure[0] + mg) * 255,\n\t\t(c * pure[1] + mg) * 255,\n\t\t(c * pure[2] + mg) * 255\n\t];\n};\n\nconvert.hcg.hsv = function (hcg) {\n\tvar c = hcg[1] / 100;\n\tvar g = hcg[2] / 100;\n\n\tvar v = c + g * (1.0 - c);\n\tvar f = 0;\n\n\tif (v > 0.0) {\n\t\tf = c / v;\n\t}\n\n\treturn [hcg[0], f * 100, v * 100];\n};\n\nconvert.hcg.hsl = function (hcg) {\n\tvar c = hcg[1] / 100;\n\tvar g = hcg[2] / 100;\n\n\tvar l = g * (1.0 - c) + 0.5 * c;\n\tvar s = 0;\n\n\tif (l > 0.0 && l < 0.5) {\n\t\ts = c / (2 * l);\n\t} else\n\tif (l >= 0.5 && l < 1.0) {\n\t\ts = c / (2 * (1 - l));\n\t}\n\n\treturn [hcg[0], s * 100, l * 100];\n};\n\nconvert.hcg.hwb = function (hcg) {\n\tvar c = hcg[1] / 100;\n\tvar g = hcg[2] / 100;\n\tvar v = c + g * (1.0 - c);\n\treturn [hcg[0], (v - c) * 100, (1 - v) * 100];\n};\n\nconvert.hwb.hcg = function (hwb) {\n\tvar w = hwb[1] / 100;\n\tvar b = hwb[2] / 100;\n\tvar v = 1 - b;\n\tvar c = v - w;\n\tvar g = 0;\n\n\tif (c < 1) {\n\t\tg = (v - c) / (1 - c);\n\t}\n\n\treturn [hwb[0], c * 100, g * 100];\n};\n\nconvert.apple.rgb = function (apple) {\n\treturn [(apple[0] / 65535) * 255, (apple[1] / 65535) * 255, (apple[2] / 65535) * 255];\n};\n\nconvert.rgb.apple = function (rgb) {\n\treturn [(rgb[0] / 255) * 65535, (rgb[1] / 255) * 65535, (rgb[2] / 255) * 65535];\n};\n\nconvert.gray.rgb = function (args) {\n\treturn [args[0] / 100 * 255, args[0] / 100 * 255, args[0] / 100 * 255];\n};\n\nconvert.gray.hsl = convert.gray.hsv = function (args) {\n\treturn [0, 0, args[0]];\n};\n\nconvert.gray.hwb = function (gray) {\n\treturn [0, 100, gray[0]];\n};\n\nconvert.gray.cmyk = function (gray) {\n\treturn [0, 0, 0, gray[0]];\n};\n\nconvert.gray.lab = function (gray) {\n\treturn [gray[0], 0, 0];\n};\n\nconvert.gray.hex = function (gray) {\n\tvar val = Math.round(gray[0] / 100 * 255) & 0xFF;\n\tvar integer = (val << 16) + (val << 8) + val;\n\n\tvar string = integer.toString(16).toUpperCase();\n\treturn '000000'.substring(string.length) + string;\n};\n\nconvert.rgb.gray = function (rgb) {\n\tvar val = (rgb[0] + rgb[1] + rgb[2]) / 3;\n\treturn [val / 255 * 100];\n};\n","var conversions = require('./conversions');\nvar route = require('./route');\n\nvar convert = {};\n\nvar models = Object.keys(conversions);\n\nfunction wrapRaw(fn) {\n\tvar wrappedFn = function (args) {\n\t\tif (args === undefined || args === null) {\n\t\t\treturn args;\n\t\t}\n\n\t\tif (arguments.length > 1) {\n\t\t\targs = Array.prototype.slice.call(arguments);\n\t\t}\n\n\t\treturn fn(args);\n\t};\n\n\t// preserve .conversion property if there is one\n\tif ('conversion' in fn) {\n\t\twrappedFn.conversion = fn.conversion;\n\t}\n\n\treturn wrappedFn;\n}\n\nfunction wrapRounded(fn) {\n\tvar wrappedFn = function (args) {\n\t\tif (args === undefined || args === null) {\n\t\t\treturn args;\n\t\t}\n\n\t\tif (arguments.length > 1) {\n\t\t\targs = Array.prototype.slice.call(arguments);\n\t\t}\n\n\t\tvar result = fn(args);\n\n\t\t// we're assuming the result is an array here.\n\t\t// see notice in conversions.js; don't use box types\n\t\t// in conversion functions.\n\t\tif (typeof result === 'object') {\n\t\t\tfor (var len = result.length, i = 0; i < len; i++) {\n\t\t\t\tresult[i] = Math.round(result[i]);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t};\n\n\t// preserve .conversion property if there is one\n\tif ('conversion' in fn) {\n\t\twrappedFn.conversion = fn.conversion;\n\t}\n\n\treturn wrappedFn;\n}\n\nmodels.forEach(function (fromModel) {\n\tconvert[fromModel] = {};\n\n\tObject.defineProperty(convert[fromModel], 'channels', {value: conversions[fromModel].channels});\n\tObject.defineProperty(convert[fromModel], 'labels', {value: conversions[fromModel].labels});\n\n\tvar routes = route(fromModel);\n\tvar routeModels = Object.keys(routes);\n\n\trouteModels.forEach(function (toModel) {\n\t\tvar fn = routes[toModel];\n\n\t\tconvert[fromModel][toModel] = wrapRounded(fn);\n\t\tconvert[fromModel][toModel].raw = wrapRaw(fn);\n\t});\n});\n\nmodule.exports = convert;\n","'use strict'\r\n\r\nmodule.exports = {\r\n\t\"aliceblue\": [240, 248, 255],\r\n\t\"antiquewhite\": [250, 235, 215],\r\n\t\"aqua\": [0, 255, 255],\r\n\t\"aquamarine\": [127, 255, 212],\r\n\t\"azure\": [240, 255, 255],\r\n\t\"beige\": [245, 245, 220],\r\n\t\"bisque\": [255, 228, 196],\r\n\t\"black\": [0, 0, 0],\r\n\t\"blanchedalmond\": [255, 235, 205],\r\n\t\"blue\": [0, 0, 255],\r\n\t\"blueviolet\": [138, 43, 226],\r\n\t\"brown\": [165, 42, 42],\r\n\t\"burlywood\": [222, 184, 135],\r\n\t\"cadetblue\": [95, 158, 160],\r\n\t\"chartreuse\": [127, 255, 0],\r\n\t\"chocolate\": [210, 105, 30],\r\n\t\"coral\": [255, 127, 80],\r\n\t\"cornflowerblue\": [100, 149, 237],\r\n\t\"cornsilk\": [255, 248, 220],\r\n\t\"crimson\": [220, 20, 60],\r\n\t\"cyan\": [0, 255, 255],\r\n\t\"darkblue\": [0, 0, 139],\r\n\t\"darkcyan\": [0, 139, 139],\r\n\t\"darkgoldenrod\": [184, 134, 11],\r\n\t\"darkgray\": [169, 169, 169],\r\n\t\"darkgreen\": [0, 100, 0],\r\n\t\"darkgrey\": [169, 169, 169],\r\n\t\"darkkhaki\": [189, 183, 107],\r\n\t\"darkmagenta\": [139, 0, 139],\r\n\t\"darkolivegreen\": [85, 107, 47],\r\n\t\"darkorange\": [255, 140, 0],\r\n\t\"darkorchid\": [153, 50, 204],\r\n\t\"darkred\": [139, 0, 0],\r\n\t\"darksalmon\": [233, 150, 122],\r\n\t\"darkseagreen\": [143, 188, 143],\r\n\t\"darkslateblue\": [72, 61, 139],\r\n\t\"darkslategray\": [47, 79, 79],\r\n\t\"darkslategrey\": [47, 79, 79],\r\n\t\"darkturquoise\": [0, 206, 209],\r\n\t\"darkviolet\": [148, 0, 211],\r\n\t\"deeppink\": [255, 20, 147],\r\n\t\"deepskyblue\": [0, 191, 255],\r\n\t\"dimgray\": [105, 105, 105],\r\n\t\"dimgrey\": [105, 105, 105],\r\n\t\"dodgerblue\": [30, 144, 255],\r\n\t\"firebrick\": [178, 34, 34],\r\n\t\"floralwhite\": [255, 250, 240],\r\n\t\"forestgreen\": [34, 139, 34],\r\n\t\"fuchsia\": [255, 0, 255],\r\n\t\"gainsboro\": [220, 220, 220],\r\n\t\"ghostwhite\": [248, 248, 255],\r\n\t\"gold\": [255, 215, 0],\r\n\t\"goldenrod\": [218, 165, 32],\r\n\t\"gray\": [128, 128, 128],\r\n\t\"green\": [0, 128, 0],\r\n\t\"greenyellow\": [173, 255, 47],\r\n\t\"grey\": [128, 128, 128],\r\n\t\"honeydew\": [240, 255, 240],\r\n\t\"hotpink\": [255, 105, 180],\r\n\t\"indianred\": [205, 92, 92],\r\n\t\"indigo\": [75, 0, 130],\r\n\t\"ivory\": [255, 255, 240],\r\n\t\"khaki\": [240, 230, 140],\r\n\t\"lavender\": [230, 230, 250],\r\n\t\"lavenderblush\": [255, 240, 245],\r\n\t\"lawngreen\": [124, 252, 0],\r\n\t\"lemonchiffon\": [255, 250, 205],\r\n\t\"lightblue\": [173, 216, 230],\r\n\t\"lightcoral\": [240, 128, 128],\r\n\t\"lightcyan\": [224, 255, 255],\r\n\t\"lightgoldenrodyellow\": [250, 250, 210],\r\n\t\"lightgray\": [211, 211, 211],\r\n\t\"lightgreen\": [144, 238, 144],\r\n\t\"lightgrey\": [211, 211, 211],\r\n\t\"lightpink\": [255, 182, 193],\r\n\t\"lightsalmon\": [255, 160, 122],\r\n\t\"lightseagreen\": [32, 178, 170],\r\n\t\"lightskyblue\": [135, 206, 250],\r\n\t\"lightslategray\": [119, 136, 153],\r\n\t\"lightslategrey\": [119, 136, 153],\r\n\t\"lightsteelblue\": [176, 196, 222],\r\n\t\"lightyellow\": [255, 255, 224],\r\n\t\"lime\": [0, 255, 0],\r\n\t\"limegreen\": [50, 205, 50],\r\n\t\"linen\": [250, 240, 230],\r\n\t\"magenta\": [255, 0, 255],\r\n\t\"maroon\": [128, 0, 0],\r\n\t\"mediumaquamarine\": [102, 205, 170],\r\n\t\"mediumblue\": [0, 0, 205],\r\n\t\"mediumorchid\": [186, 85, 211],\r\n\t\"mediumpurple\": [147, 112, 219],\r\n\t\"mediumseagreen\": [60, 179, 113],\r\n\t\"mediumslateblue\": [123, 104, 238],\r\n\t\"mediumspringgreen\": [0, 250, 154],\r\n\t\"mediumturquoise\": [72, 209, 204],\r\n\t\"mediumvioletred\": [199, 21, 133],\r\n\t\"midnightblue\": [25, 25, 112],\r\n\t\"mintcream\": [245, 255, 250],\r\n\t\"mistyrose\": [255, 228, 225],\r\n\t\"moccasin\": [255, 228, 181],\r\n\t\"navajowhite\": [255, 222, 173],\r\n\t\"navy\": [0, 0, 128],\r\n\t\"oldlace\": [253, 245, 230],\r\n\t\"olive\": [128, 128, 0],\r\n\t\"olivedrab\": [107, 142, 35],\r\n\t\"orange\": [255, 165, 0],\r\n\t\"orangered\": [255, 69, 0],\r\n\t\"orchid\": [218, 112, 214],\r\n\t\"palegoldenrod\": [238, 232, 170],\r\n\t\"palegreen\": [152, 251, 152],\r\n\t\"paleturquoise\": [175, 238, 238],\r\n\t\"palevioletred\": [219, 112, 147],\r\n\t\"papayawhip\": [255, 239, 213],\r\n\t\"peachpuff\": [255, 218, 185],\r\n\t\"peru\": [205, 133, 63],\r\n\t\"pink\": [255, 192, 203],\r\n\t\"plum\": [221, 160, 221],\r\n\t\"powderblue\": [176, 224, 230],\r\n\t\"purple\": [128, 0, 128],\r\n\t\"rebeccapurple\": [102, 51, 153],\r\n\t\"red\": [255, 0, 0],\r\n\t\"rosybrown\": [188, 143, 143],\r\n\t\"royalblue\": [65, 105, 225],\r\n\t\"saddlebrown\": [139, 69, 19],\r\n\t\"salmon\": [250, 128, 114],\r\n\t\"sandybrown\": [244, 164, 96],\r\n\t\"seagreen\": [46, 139, 87],\r\n\t\"seashell\": [255, 245, 238],\r\n\t\"sienna\": [160, 82, 45],\r\n\t\"silver\": [192, 192, 192],\r\n\t\"skyblue\": [135, 206, 235],\r\n\t\"slateblue\": [106, 90, 205],\r\n\t\"slategray\": [112, 128, 144],\r\n\t\"slategrey\": [112, 128, 144],\r\n\t\"snow\": [255, 250, 250],\r\n\t\"springgreen\": [0, 255, 127],\r\n\t\"steelblue\": [70, 130, 180],\r\n\t\"tan\": [210, 180, 140],\r\n\t\"teal\": [0, 128, 128],\r\n\t\"thistle\": [216, 191, 216],\r\n\t\"tomato\": [255, 99, 71],\r\n\t\"turquoise\": [64, 224, 208],\r\n\t\"violet\": [238, 130, 238],\r\n\t\"wheat\": [245, 222, 179],\r\n\t\"white\": [255, 255, 255],\r\n\t\"whitesmoke\": [245, 245, 245],\r\n\t\"yellow\": [255, 255, 0],\r\n\t\"yellowgreen\": [154, 205, 50]\r\n};\r\n","var conversions = require('./conversions');\n\n/*\n\tthis function routes a model to all other models.\n\n\tall functions that are routed have a property `.conversion` attached\n\tto the returned synthetic function. This property is an array\n\tof strings, each with the steps in between the 'from' and 'to'\n\tcolor models (inclusive).\n\n\tconversions that are not possible simply are not included.\n*/\n\nfunction buildGraph() {\n\tvar graph = {};\n\t// https://jsperf.com/object-keys-vs-for-in-with-closure/3\n\tvar models = Object.keys(conversions);\n\n\tfor (var len = models.length, i = 0; i < len; i++) {\n\t\tgraph[models[i]] = {\n\t\t\t// http://jsperf.com/1-vs-infinity\n\t\t\t// micro-opt, but this is simple.\n\t\t\tdistance: -1,\n\t\t\tparent: null\n\t\t};\n\t}\n\n\treturn graph;\n}\n\n// https://en.wikipedia.org/wiki/Breadth-first_search\nfunction deriveBFS(fromModel) {\n\tvar graph = buildGraph();\n\tvar queue = [fromModel]; // unshift -> queue -> pop\n\n\tgraph[fromModel].distance = 0;\n\n\twhile (queue.length) {\n\t\tvar current = queue.pop();\n\t\tvar adjacents = Object.keys(conversions[current]);\n\n\t\tfor (var len = adjacents.length, i = 0; i < len; i++) {\n\t\t\tvar adjacent = adjacents[i];\n\t\t\tvar node = graph[adjacent];\n\n\t\t\tif (node.distance === -1) {\n\t\t\t\tnode.distance = graph[current].distance + 1;\n\t\t\t\tnode.parent = current;\n\t\t\t\tqueue.unshift(adjacent);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn graph;\n}\n\nfunction link(from, to) {\n\treturn function (args) {\n\t\treturn to(from(args));\n\t};\n}\n\nfunction wrapConversion(toModel, graph) {\n\tvar path = [graph[toModel].parent, toModel];\n\tvar fn = conversions[graph[toModel].parent][toModel];\n\n\tvar cur = graph[toModel].parent;\n\twhile (graph[cur].parent) {\n\t\tpath.unshift(graph[cur].parent);\n\t\tfn = link(conversions[graph[cur].parent][cur], fn);\n\t\tcur = graph[cur].parent;\n\t}\n\n\tfn.conversion = path;\n\treturn fn;\n}\n\nmodule.exports = function (fromModel) {\n\tvar graph = deriveBFS(fromModel);\n\tvar conversion = {};\n\n\tvar models = Object.keys(graph);\n\tfor (var len = models.length, i = 0; i < len; i++) {\n\t\tvar toModel = models[i];\n\t\tvar node = graph[toModel];\n\n\t\tif (node.parent === null) {\n\t\t\t// no possible conversion, or this node is the source model.\n\t\t\tcontinue;\n\t\t}\n\n\t\tconversion[toModel] = wrapConversion(toModel, graph);\n\t}\n\n\treturn conversion;\n};\n\n","'use strict'\r\n\r\nmodule.exports = {\r\n\t\"aliceblue\": [240, 248, 255],\r\n\t\"antiquewhite\": [250, 235, 215],\r\n\t\"aqua\": [0, 255, 255],\r\n\t\"aquamarine\": [127, 255, 212],\r\n\t\"azure\": [240, 255, 255],\r\n\t\"beige\": [245, 245, 220],\r\n\t\"bisque\": [255, 228, 196],\r\n\t\"black\": [0, 0, 0],\r\n\t\"blanchedalmond\": [255, 235, 205],\r\n\t\"blue\": [0, 0, 255],\r\n\t\"blueviolet\": [138, 43, 226],\r\n\t\"brown\": [165, 42, 42],\r\n\t\"burlywood\": [222, 184, 135],\r\n\t\"cadetblue\": [95, 158, 160],\r\n\t\"chartreuse\": [127, 255, 0],\r\n\t\"chocolate\": [210, 105, 30],\r\n\t\"coral\": [255, 127, 80],\r\n\t\"cornflowerblue\": [100, 149, 237],\r\n\t\"cornsilk\": [255, 248, 220],\r\n\t\"crimson\": [220, 20, 60],\r\n\t\"cyan\": [0, 255, 255],\r\n\t\"darkblue\": [0, 0, 139],\r\n\t\"darkcyan\": [0, 139, 139],\r\n\t\"darkgoldenrod\": [184, 134, 11],\r\n\t\"darkgray\": [169, 169, 169],\r\n\t\"darkgreen\": [0, 100, 0],\r\n\t\"darkgrey\": [169, 169, 169],\r\n\t\"darkkhaki\": [189, 183, 107],\r\n\t\"darkmagenta\": [139, 0, 139],\r\n\t\"darkolivegreen\": [85, 107, 47],\r\n\t\"darkorange\": [255, 140, 0],\r\n\t\"darkorchid\": [153, 50, 204],\r\n\t\"darkred\": [139, 0, 0],\r\n\t\"darksalmon\": [233, 150, 122],\r\n\t\"darkseagreen\": [143, 188, 143],\r\n\t\"darkslateblue\": [72, 61, 139],\r\n\t\"darkslategray\": [47, 79, 79],\r\n\t\"darkslategrey\": [47, 79, 79],\r\n\t\"darkturquoise\": [0, 206, 209],\r\n\t\"darkviolet\": [148, 0, 211],\r\n\t\"deeppink\": [255, 20, 147],\r\n\t\"deepskyblue\": [0, 191, 255],\r\n\t\"dimgray\": [105, 105, 105],\r\n\t\"dimgrey\": [105, 105, 105],\r\n\t\"dodgerblue\": [30, 144, 255],\r\n\t\"firebrick\": [178, 34, 34],\r\n\t\"floralwhite\": [255, 250, 240],\r\n\t\"forestgreen\": [34, 139, 34],\r\n\t\"fuchsia\": [255, 0, 255],\r\n\t\"gainsboro\": [220, 220, 220],\r\n\t\"ghostwhite\": [248, 248, 255],\r\n\t\"gold\": [255, 215, 0],\r\n\t\"goldenrod\": [218, 165, 32],\r\n\t\"gray\": [128, 128, 128],\r\n\t\"green\": [0, 128, 0],\r\n\t\"greenyellow\": [173, 255, 47],\r\n\t\"grey\": [128, 128, 128],\r\n\t\"honeydew\": [240, 255, 240],\r\n\t\"hotpink\": [255, 105, 180],\r\n\t\"indianred\": [205, 92, 92],\r\n\t\"indigo\": [75, 0, 130],\r\n\t\"ivory\": [255, 255, 240],\r\n\t\"khaki\": [240, 230, 140],\r\n\t\"lavender\": [230, 230, 250],\r\n\t\"lavenderblush\": [255, 240, 245],\r\n\t\"lawngreen\": [124, 252, 0],\r\n\t\"lemonchiffon\": [255, 250, 205],\r\n\t\"lightblue\": [173, 216, 230],\r\n\t\"lightcoral\": [240, 128, 128],\r\n\t\"lightcyan\": [224, 255, 255],\r\n\t\"lightgoldenrodyellow\": [250, 250, 210],\r\n\t\"lightgray\": [211, 211, 211],\r\n\t\"lightgreen\": [144, 238, 144],\r\n\t\"lightgrey\": [211, 211, 211],\r\n\t\"lightpink\": [255, 182, 193],\r\n\t\"lightsalmon\": [255, 160, 122],\r\n\t\"lightseagreen\": [32, 178, 170],\r\n\t\"lightskyblue\": [135, 206, 250],\r\n\t\"lightslategray\": [119, 136, 153],\r\n\t\"lightslategrey\": [119, 136, 153],\r\n\t\"lightsteelblue\": [176, 196, 222],\r\n\t\"lightyellow\": [255, 255, 224],\r\n\t\"lime\": [0, 255, 0],\r\n\t\"limegreen\": [50, 205, 50],\r\n\t\"linen\": [250, 240, 230],\r\n\t\"magenta\": [255, 0, 255],\r\n\t\"maroon\": [128, 0, 0],\r\n\t\"mediumaquamarine\": [102, 205, 170],\r\n\t\"mediumblue\": [0, 0, 205],\r\n\t\"mediumorchid\": [186, 85, 211],\r\n\t\"mediumpurple\": [147, 112, 219],\r\n\t\"mediumseagreen\": [60, 179, 113],\r\n\t\"mediumslateblue\": [123, 104, 238],\r\n\t\"mediumspringgreen\": [0, 250, 154],\r\n\t\"mediumturquoise\": [72, 209, 204],\r\n\t\"mediumvioletred\": [199, 21, 133],\r\n\t\"midnightblue\": [25, 25, 112],\r\n\t\"mintcream\": [245, 255, 250],\r\n\t\"mistyrose\": [255, 228, 225],\r\n\t\"moccasin\": [255, 228, 181],\r\n\t\"navajowhite\": [255, 222, 173],\r\n\t\"navy\": [0, 0, 128],\r\n\t\"oldlace\": [253, 245, 230],\r\n\t\"olive\": [128, 128, 0],\r\n\t\"olivedrab\": [107, 142, 35],\r\n\t\"orange\": [255, 165, 0],\r\n\t\"orangered\": [255, 69, 0],\r\n\t\"orchid\": [218, 112, 214],\r\n\t\"palegoldenrod\": [238, 232, 170],\r\n\t\"palegreen\": [152, 251, 152],\r\n\t\"paleturquoise\": [175, 238, 238],\r\n\t\"palevioletred\": [219, 112, 147],\r\n\t\"papayawhip\": [255, 239, 213],\r\n\t\"peachpuff\": [255, 218, 185],\r\n\t\"peru\": [205, 133, 63],\r\n\t\"pink\": [255, 192, 203],\r\n\t\"plum\": [221, 160, 221],\r\n\t\"powderblue\": [176, 224, 230],\r\n\t\"purple\": [128, 0, 128],\r\n\t\"rebeccapurple\": [102, 51, 153],\r\n\t\"red\": [255, 0, 0],\r\n\t\"rosybrown\": [188, 143, 143],\r\n\t\"royalblue\": [65, 105, 225],\r\n\t\"saddlebrown\": [139, 69, 19],\r\n\t\"salmon\": [250, 128, 114],\r\n\t\"sandybrown\": [244, 164, 96],\r\n\t\"seagreen\": [46, 139, 87],\r\n\t\"seashell\": [255, 245, 238],\r\n\t\"sienna\": [160, 82, 45],\r\n\t\"silver\": [192, 192, 192],\r\n\t\"skyblue\": [135, 206, 235],\r\n\t\"slateblue\": [106, 90, 205],\r\n\t\"slategray\": [112, 128, 144],\r\n\t\"slategrey\": [112, 128, 144],\r\n\t\"snow\": [255, 250, 250],\r\n\t\"springgreen\": [0, 255, 127],\r\n\t\"steelblue\": [70, 130, 180],\r\n\t\"tan\": [210, 180, 140],\r\n\t\"teal\": [0, 128, 128],\r\n\t\"thistle\": [216, 191, 216],\r\n\t\"tomato\": [255, 99, 71],\r\n\t\"turquoise\": [64, 224, 208],\r\n\t\"violet\": [238, 130, 238],\r\n\t\"wheat\": [245, 222, 179],\r\n\t\"white\": [255, 255, 255],\r\n\t\"whitesmoke\": [245, 245, 245],\r\n\t\"yellow\": [255, 255, 0],\r\n\t\"yellowgreen\": [154, 205, 50]\r\n};\r\n","/* MIT license */\nvar colorNames = require('color-name');\nvar swizzle = require('simple-swizzle');\n\nvar reverseNames = {};\n\n// create a list of reverse color names\nfor (var name in colorNames) {\n\tif (colorNames.hasOwnProperty(name)) {\n\t\treverseNames[colorNames[name]] = name;\n\t}\n}\n\nvar cs = module.exports = {\n\tto: {},\n\tget: {}\n};\n\ncs.get = function (string) {\n\tvar prefix = string.substring(0, 3).toLowerCase();\n\tvar val;\n\tvar model;\n\tswitch (prefix) {\n\t\tcase 'hsl':\n\t\t\tval = cs.get.hsl(string);\n\t\t\tmodel = 'hsl';\n\t\t\tbreak;\n\t\tcase 'hwb':\n\t\t\tval = cs.get.hwb(string);\n\t\t\tmodel = 'hwb';\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tval = cs.get.rgb(string);\n\t\t\tmodel = 'rgb';\n\t\t\tbreak;\n\t}\n\n\tif (!val) {\n\t\treturn null;\n\t}\n\n\treturn {model: model, value: val};\n};\n\ncs.get.rgb = function (string) {\n\tif (!string) {\n\t\treturn null;\n\t}\n\n\tvar abbr = /^#([a-f0-9]{3,4})$/i;\n\tvar hex = /^#([a-f0-9]{6})([a-f0-9]{2})?$/i;\n\tvar rgba = /^rgba?\\(\\s*([+-]?\\d+)\\s*,\\s*([+-]?\\d+)\\s*,\\s*([+-]?\\d+)\\s*(?:,\\s*([+-]?[\\d\\.]+)\\s*)?\\)$/;\n\tvar per = /^rgba?\\(\\s*([+-]?[\\d\\.]+)\\%\\s*,\\s*([+-]?[\\d\\.]+)\\%\\s*,\\s*([+-]?[\\d\\.]+)\\%\\s*(?:,\\s*([+-]?[\\d\\.]+)\\s*)?\\)$/;\n\tvar keyword = /(\\D+)/;\n\n\tvar rgb = [0, 0, 0, 1];\n\tvar match;\n\tvar i;\n\tvar hexAlpha;\n\n\tif (match = string.match(hex)) {\n\t\thexAlpha = match[2];\n\t\tmatch = match[1];\n\n\t\tfor (i = 0; i < 3; i++) {\n\t\t\t// https://jsperf.com/slice-vs-substr-vs-substring-methods-long-string/19\n\t\t\tvar i2 = i * 2;\n\t\t\trgb[i] = parseInt(match.slice(i2, i2 + 2), 16);\n\t\t}\n\n\t\tif (hexAlpha) {\n\t\t\trgb[3] = Math.round((parseInt(hexAlpha, 16) / 255) * 100) / 100;\n\t\t}\n\t} else if (match = string.match(abbr)) {\n\t\tmatch = match[1];\n\t\thexAlpha = match[3];\n\n\t\tfor (i = 0; i < 3; i++) {\n\t\t\trgb[i] = parseInt(match[i] + match[i], 16);\n\t\t}\n\n\t\tif (hexAlpha) {\n\t\t\trgb[3] = Math.round((parseInt(hexAlpha + hexAlpha, 16) / 255) * 100) / 100;\n\t\t}\n\t} else if (match = string.match(rgba)) {\n\t\tfor (i = 0; i < 3; i++) {\n\t\t\trgb[i] = parseInt(match[i + 1], 0);\n\t\t}\n\n\t\tif (match[4]) {\n\t\t\trgb[3] = parseFloat(match[4]);\n\t\t}\n\t} else if (match = string.match(per)) {\n\t\tfor (i = 0; i < 3; i++) {\n\t\t\trgb[i] = Math.round(parseFloat(match[i + 1]) * 2.55);\n\t\t}\n\n\t\tif (match[4]) {\n\t\t\trgb[3] = parseFloat(match[4]);\n\t\t}\n\t} else if (match = string.match(keyword)) {\n\t\tif (match[1] === 'transparent') {\n\t\t\treturn [0, 0, 0, 0];\n\t\t}\n\n\t\trgb = colorNames[match[1]];\n\n\t\tif (!rgb) {\n\t\t\treturn null;\n\t\t}\n\n\t\trgb[3] = 1;\n\n\t\treturn rgb;\n\t} else {\n\t\treturn null;\n\t}\n\n\tfor (i = 0; i < 3; i++) {\n\t\trgb[i] = clamp(rgb[i], 0, 255);\n\t}\n\trgb[3] = clamp(rgb[3], 0, 1);\n\n\treturn rgb;\n};\n\ncs.get.hsl = function (string) {\n\tif (!string) {\n\t\treturn null;\n\t}\n\n\tvar hsl = /^hsla?\\(\\s*([+-]?(?:\\d*\\.)?\\d+)(?:deg)?\\s*,\\s*([+-]?[\\d\\.]+)%\\s*,\\s*([+-]?[\\d\\.]+)%\\s*(?:,\\s*([+-]?[\\d\\.]+)\\s*)?\\)$/;\n\tvar match = string.match(hsl);\n\n\tif (match) {\n\t\tvar alpha = parseFloat(match[4]);\n\t\tvar h = (parseFloat(match[1]) + 360) % 360;\n\t\tvar s = clamp(parseFloat(match[2]), 0, 100);\n\t\tvar l = clamp(parseFloat(match[3]), 0, 100);\n\t\tvar a = clamp(isNaN(alpha) ? 1 : alpha, 0, 1);\n\n\t\treturn [h, s, l, a];\n\t}\n\n\treturn null;\n};\n\ncs.get.hwb = function (string) {\n\tif (!string) {\n\t\treturn null;\n\t}\n\n\tvar hwb = /^hwb\\(\\s*([+-]?\\d*[\\.]?\\d+)(?:deg)?\\s*,\\s*([+-]?[\\d\\.]+)%\\s*,\\s*([+-]?[\\d\\.]+)%\\s*(?:,\\s*([+-]?[\\d\\.]+)\\s*)?\\)$/;\n\tvar match = string.match(hwb);\n\n\tif (match) {\n\t\tvar alpha = parseFloat(match[4]);\n\t\tvar h = ((parseFloat(match[1]) % 360) + 360) % 360;\n\t\tvar w = clamp(parseFloat(match[2]), 0, 100);\n\t\tvar b = clamp(parseFloat(match[3]), 0, 100);\n\t\tvar a = clamp(isNaN(alpha) ? 1 : alpha, 0, 1);\n\t\treturn [h, w, b, a];\n\t}\n\n\treturn null;\n};\n\ncs.to.hex = function () {\n\tvar rgba = swizzle(arguments);\n\n\treturn (\n\t\t'#' +\n\t\thexDouble(rgba[0]) +\n\t\thexDouble(rgba[1]) +\n\t\thexDouble(rgba[2]) +\n\t\t(rgba[3] < 1\n\t\t\t? (hexDouble(Math.round(rgba[3] * 255)))\n\t\t\t: '')\n\t);\n};\n\ncs.to.rgb = function () {\n\tvar rgba = swizzle(arguments);\n\n\treturn rgba.length < 4 || rgba[3] === 1\n\t\t? 'rgb(' + Math.round(rgba[0]) + ', ' + Math.round(rgba[1]) + ', ' + Math.round(rgba[2]) + ')'\n\t\t: 'rgba(' + Math.round(rgba[0]) + ', ' + Math.round(rgba[1]) + ', ' + Math.round(rgba[2]) + ', ' + rgba[3] + ')';\n};\n\ncs.to.rgb.percent = function () {\n\tvar rgba = swizzle(arguments);\n\n\tvar r = Math.round(rgba[0] / 255 * 100);\n\tvar g = Math.round(rgba[1] / 255 * 100);\n\tvar b = Math.round(rgba[2] / 255 * 100);\n\n\treturn rgba.length < 4 || rgba[3] === 1\n\t\t? 'rgb(' + r + '%, ' + g + '%, ' + b + '%)'\n\t\t: 'rgba(' + r + '%, ' + g + '%, ' + b + '%, ' + rgba[3] + ')';\n};\n\ncs.to.hsl = function () {\n\tvar hsla = swizzle(arguments);\n\treturn hsla.length < 4 || hsla[3] === 1\n\t\t? 'hsl(' + hsla[0] + ', ' + hsla[1] + '%, ' + hsla[2] + '%)'\n\t\t: 'hsla(' + hsla[0] + ', ' + hsla[1] + '%, ' + hsla[2] + '%, ' + hsla[3] + ')';\n};\n\n// hwb is a bit different than rgb(a) & hsl(a) since there is no alpha specific syntax\n// (hwb have alpha optional & 1 is default value)\ncs.to.hwb = function () {\n\tvar hwba = swizzle(arguments);\n\n\tvar a = '';\n\tif (hwba.length >= 4 && hwba[3] !== 1) {\n\t\ta = ', ' + hwba[3];\n\t}\n\n\treturn 'hwb(' + hwba[0] + ', ' + hwba[1] + '%, ' + hwba[2] + '%' + a + ')';\n};\n\ncs.to.keyword = function (rgb) {\n\treturn reverseNames[rgb.slice(0, 3)];\n};\n\n// helpers\nfunction clamp(num, min, max) {\n\treturn Math.min(Math.max(min, num), max);\n}\n\nfunction hexDouble(num) {\n\tvar str = num.toString(16).toUpperCase();\n\treturn (str.length < 2) ? '0' + str : str;\n}\n","'use strict';\n\nvar colorString = require('color-string');\nvar convert = require('color-convert');\n\nvar _slice = [].slice;\n\nvar skippedModels = [\n\t// to be honest, I don't really feel like keyword belongs in color convert, but eh.\n\t'keyword',\n\n\t// gray conflicts with some method names, and has its own method defined.\n\t'gray',\n\n\t// shouldn't really be in color-convert either...\n\t'hex'\n];\n\nvar hashedModelKeys = {};\nObject.keys(convert).forEach(function (model) {\n\thashedModelKeys[_slice.call(convert[model].labels).sort().join('')] = model;\n});\n\nvar limiters = {};\n\nfunction Color(obj, model) {\n\tif (!(this instanceof Color)) {\n\t\treturn new Color(obj, model);\n\t}\n\n\tif (model && model in skippedModels) {\n\t\tmodel = null;\n\t}\n\n\tif (model && !(model in convert)) {\n\t\tthrow new Error('Unknown model: ' + model);\n\t}\n\n\tvar i;\n\tvar channels;\n\n\tif (obj == null) { // eslint-disable-line no-eq-null,eqeqeq\n\t\tthis.model = 'rgb';\n\t\tthis.color = [0, 0, 0];\n\t\tthis.valpha = 1;\n\t} else if (obj instanceof Color) {\n\t\tthis.model = obj.model;\n\t\tthis.color = obj.color.slice();\n\t\tthis.valpha = obj.valpha;\n\t} else if (typeof obj === 'string') {\n\t\tvar result = colorString.get(obj);\n\t\tif (result === null) {\n\t\t\tthrow new Error('Unable to parse color from string: ' + obj);\n\t\t}\n\n\t\tthis.model = result.model;\n\t\tchannels = convert[this.model].channels;\n\t\tthis.color = result.value.slice(0, channels);\n\t\tthis.valpha = typeof result.value[channels] === 'number' ? result.value[channels] : 1;\n\t} else if (obj.length) {\n\t\tthis.model = model || 'rgb';\n\t\tchannels = convert[this.model].channels;\n\t\tvar newArr = _slice.call(obj, 0, channels);\n\t\tthis.color = zeroArray(newArr, channels);\n\t\tthis.valpha = typeof obj[channels] === 'number' ? obj[channels] : 1;\n\t} else if (typeof obj === 'number') {\n\t\t// this is always RGB - can be converted later on.\n\t\tobj &= 0xFFFFFF;\n\t\tthis.model = 'rgb';\n\t\tthis.color = [\n\t\t\t(obj >> 16) & 0xFF,\n\t\t\t(obj >> 8) & 0xFF,\n\t\t\tobj & 0xFF\n\t\t];\n\t\tthis.valpha = 1;\n\t} else {\n\t\tthis.valpha = 1;\n\n\t\tvar keys = Object.keys(obj);\n\t\tif ('alpha' in obj) {\n\t\t\tkeys.splice(keys.indexOf('alpha'), 1);\n\t\t\tthis.valpha = typeof obj.alpha === 'number' ? obj.alpha : 0;\n\t\t}\n\n\t\tvar hashedKeys = keys.sort().join('');\n\t\tif (!(hashedKeys in hashedModelKeys)) {\n\t\t\tthrow new Error('Unable to parse color from object: ' + JSON.stringify(obj));\n\t\t}\n\n\t\tthis.model = hashedModelKeys[hashedKeys];\n\n\t\tvar labels = convert[this.model].labels;\n\t\tvar color = [];\n\t\tfor (i = 0; i < labels.length; i++) {\n\t\t\tcolor.push(obj[labels[i]]);\n\t\t}\n\n\t\tthis.color = zeroArray(color);\n\t}\n\n\t// perform limitations (clamping, etc.)\n\tif (limiters[this.model]) {\n\t\tchannels = convert[this.model].channels;\n\t\tfor (i = 0; i < channels; i++) {\n\t\t\tvar limit = limiters[this.model][i];\n\t\t\tif (limit) {\n\t\t\t\tthis.color[i] = limit(this.color[i]);\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.valpha = Math.max(0, Math.min(1, this.valpha));\n\n\tif (Object.freeze) {\n\t\tObject.freeze(this);\n\t}\n}\n\nColor.prototype = {\n\ttoString: function () {\n\t\treturn this.string();\n\t},\n\n\ttoJSON: function () {\n\t\treturn this[this.model]();\n\t},\n\n\tstring: function (places) {\n\t\tvar self = this.model in colorString.to ? this : this.rgb();\n\t\tself = self.round(typeof places === 'number' ? places : 1);\n\t\tvar args = self.valpha === 1 ? self.color : self.color.concat(this.valpha);\n\t\treturn colorString.to[self.model](args);\n\t},\n\n\tpercentString: function (places) {\n\t\tvar self = this.rgb().round(typeof places === 'number' ? places : 1);\n\t\tvar args = self.valpha === 1 ? self.color : self.color.concat(this.valpha);\n\t\treturn colorString.to.rgb.percent(args);\n\t},\n\n\tarray: function () {\n\t\treturn this.valpha === 1 ? this.color.slice() : this.color.concat(this.valpha);\n\t},\n\n\tobject: function () {\n\t\tvar result = {};\n\t\tvar channels = convert[this.model].channels;\n\t\tvar labels = convert[this.model].labels;\n\n\t\tfor (var i = 0; i < channels; i++) {\n\t\t\tresult[labels[i]] = this.color[i];\n\t\t}\n\n\t\tif (this.valpha !== 1) {\n\t\t\tresult.alpha = this.valpha;\n\t\t}\n\n\t\treturn result;\n\t},\n\n\tunitArray: function () {\n\t\tvar rgb = this.rgb().color;\n\t\trgb[0] /= 255;\n\t\trgb[1] /= 255;\n\t\trgb[2] /= 255;\n\n\t\tif (this.valpha !== 1) {\n\t\t\trgb.push(this.valpha);\n\t\t}\n\n\t\treturn rgb;\n\t},\n\n\tunitObject: function () {\n\t\tvar rgb = this.rgb().object();\n\t\trgb.r /= 255;\n\t\trgb.g /= 255;\n\t\trgb.b /= 255;\n\n\t\tif (this.valpha !== 1) {\n\t\t\trgb.alpha = this.valpha;\n\t\t}\n\n\t\treturn rgb;\n\t},\n\n\tround: function (places) {\n\t\tplaces = Math.max(places || 0, 0);\n\t\treturn new Color(this.color.map(roundToPlace(places)).concat(this.valpha), this.model);\n\t},\n\n\talpha: function (val) {\n\t\tif (arguments.length) {\n\t\t\treturn new Color(this.color.concat(Math.max(0, Math.min(1, val))), this.model);\n\t\t}\n\n\t\treturn this.valpha;\n\t},\n\n\t// rgb\n\tred: getset('rgb', 0, maxfn(255)),\n\tgreen: getset('rgb', 1, maxfn(255)),\n\tblue: getset('rgb', 2, maxfn(255)),\n\n\thue: getset(['hsl', 'hsv', 'hsl', 'hwb', 'hcg'], 0, function (val) { return ((val % 360) + 360) % 360; }), // eslint-disable-line brace-style\n\n\tsaturationl: getset('hsl', 1, maxfn(100)),\n\tlightness: getset('hsl', 2, maxfn(100)),\n\n\tsaturationv: getset('hsv', 1, maxfn(100)),\n\tvalue: getset('hsv', 2, maxfn(100)),\n\n\tchroma: getset('hcg', 1, maxfn(100)),\n\tgray: getset('hcg', 2, maxfn(100)),\n\n\twhite: getset('hwb', 1, maxfn(100)),\n\twblack: getset('hwb', 2, maxfn(100)),\n\n\tcyan: getset('cmyk', 0, maxfn(100)),\n\tmagenta: getset('cmyk', 1, maxfn(100)),\n\tyellow: getset('cmyk', 2, maxfn(100)),\n\tblack: getset('cmyk', 3, maxfn(100)),\n\n\tx: getset('xyz', 0, maxfn(100)),\n\ty: getset('xyz', 1, maxfn(100)),\n\tz: getset('xyz', 2, maxfn(100)),\n\n\tl: getset('lab', 0, maxfn(100)),\n\ta: getset('lab', 1),\n\tb: getset('lab', 2),\n\n\tkeyword: function (val) {\n\t\tif (arguments.length) {\n\t\t\treturn new Color(val);\n\t\t}\n\n\t\treturn convert[this.model].keyword(this.color);\n\t},\n\n\thex: function (val) {\n\t\tif (arguments.length) {\n\t\t\treturn new Color(val);\n\t\t}\n\n\t\treturn colorString.to.hex(this.rgb().round().color);\n\t},\n\n\trgbNumber: function () {\n\t\tvar rgb = this.rgb().color;\n\t\treturn ((rgb[0] & 0xFF) << 16) | ((rgb[1] & 0xFF) << 8) | (rgb[2] & 0xFF);\n\t},\n\n\tluminosity: function () {\n\t\t// http://www.w3.org/TR/WCAG20/#relativeluminancedef\n\t\tvar rgb = this.rgb().color;\n\n\t\tvar lum = [];\n\t\tfor (var i = 0; i < rgb.length; i++) {\n\t\t\tvar chan = rgb[i] / 255;\n\t\t\tlum[i] = (chan <= 0.03928) ? chan / 12.92 : Math.pow(((chan + 0.055) / 1.055), 2.4);\n\t\t}\n\n\t\treturn 0.2126 * lum[0] + 0.7152 * lum[1] + 0.0722 * lum[2];\n\t},\n\n\tcontrast: function (color2) {\n\t\t// http://www.w3.org/TR/WCAG20/#contrast-ratiodef\n\t\tvar lum1 = this.luminosity();\n\t\tvar lum2 = color2.luminosity();\n\n\t\tif (lum1 > lum2) {\n\t\t\treturn (lum1 + 0.05) / (lum2 + 0.05);\n\t\t}\n\n\t\treturn (lum2 + 0.05) / (lum1 + 0.05);\n\t},\n\n\tlevel: function (color2) {\n\t\tvar contrastRatio = this.contrast(color2);\n\t\tif (contrastRatio >= 7.1) {\n\t\t\treturn 'AAA';\n\t\t}\n\n\t\treturn (contrastRatio >= 4.5) ? 'AA' : '';\n\t},\n\n\tisDark: function () {\n\t\t// YIQ equation from http://24ways.org/2010/calculating-color-contrast\n\t\tvar rgb = this.rgb().color;\n\t\tvar yiq = (rgb[0] * 299 + rgb[1] * 587 + rgb[2] * 114) / 1000;\n\t\treturn yiq < 128;\n\t},\n\n\tisLight: function () {\n\t\treturn !this.isDark();\n\t},\n\n\tnegate: function () {\n\t\tvar rgb = this.rgb();\n\t\tfor (var i = 0; i < 3; i++) {\n\t\t\trgb.color[i] = 255 - rgb.color[i];\n\t\t}\n\t\treturn rgb;\n\t},\n\n\tlighten: function (ratio) {\n\t\tvar hsl = this.hsl();\n\t\thsl.color[2] += hsl.color[2] * ratio;\n\t\treturn hsl;\n\t},\n\n\tdarken: function (ratio) {\n\t\tvar hsl = this.hsl();\n\t\thsl.color[2] -= hsl.color[2] * ratio;\n\t\treturn hsl;\n\t},\n\n\tsaturate: function (ratio) {\n\t\tvar hsl = this.hsl();\n\t\thsl.color[1] += hsl.color[1] * ratio;\n\t\treturn hsl;\n\t},\n\n\tdesaturate: function (ratio) {\n\t\tvar hsl = this.hsl();\n\t\thsl.color[1] -= hsl.color[1] * ratio;\n\t\treturn hsl;\n\t},\n\n\twhiten: function (ratio) {\n\t\tvar hwb = this.hwb();\n\t\thwb.color[1] += hwb.color[1] * ratio;\n\t\treturn hwb;\n\t},\n\n\tblacken: function (ratio) {\n\t\tvar hwb = this.hwb();\n\t\thwb.color[2] += hwb.color[2] * ratio;\n\t\treturn hwb;\n\t},\n\n\tgrayscale: function () {\n\t\t// http://en.wikipedia.org/wiki/Grayscale#Converting_color_to_grayscale\n\t\tvar rgb = this.rgb().color;\n\t\tvar val = rgb[0] * 0.3 + rgb[1] * 0.59 + rgb[2] * 0.11;\n\t\treturn Color.rgb(val, val, val);\n\t},\n\n\tfade: function (ratio) {\n\t\treturn this.alpha(this.valpha - (this.valpha * ratio));\n\t},\n\n\topaquer: function (ratio) {\n\t\treturn this.alpha(this.valpha + (this.valpha * ratio));\n\t},\n\n\trotate: function (degrees) {\n\t\tvar hsl = this.hsl();\n\t\tvar hue = hsl.color[0];\n\t\thue = (hue + degrees) % 360;\n\t\thue = hue < 0 ? 360 + hue : hue;\n\t\thsl.color[0] = hue;\n\t\treturn hsl;\n\t},\n\n\tmix: function (mixinColor, weight) {\n\t\t// ported from sass implementation in C\n\t\t// https://github.com/sass/libsass/blob/0e6b4a2850092356aa3ece07c6b249f0221caced/functions.cpp#L209\n\t\tif (!mixinColor || !mixinColor.rgb) {\n\t\t\tthrow new Error('Argument to \"mix\" was not a Color instance, but rather an instance of ' + typeof mixinColor);\n\t\t}\n\t\tvar color1 = mixinColor.rgb();\n\t\tvar color2 = this.rgb();\n\t\tvar p = weight === undefined ? 0.5 : weight;\n\n\t\tvar w = 2 * p - 1;\n\t\tvar a = color1.alpha() - color2.alpha();\n\n\t\tvar w1 = (((w * a === -1) ? w : (w + a) / (1 + w * a)) + 1) / 2.0;\n\t\tvar w2 = 1 - w1;\n\n\t\treturn Color.rgb(\n\t\t\t\tw1 * color1.red() + w2 * color2.red(),\n\t\t\t\tw1 * color1.green() + w2 * color2.green(),\n\t\t\t\tw1 * color1.blue() + w2 * color2.blue(),\n\t\t\t\tcolor1.alpha() * p + color2.alpha() * (1 - p));\n\t}\n};\n\n// model conversion methods and static constructors\nObject.keys(convert).forEach(function (model) {\n\tif (skippedModels.indexOf(model) !== -1) {\n\t\treturn;\n\t}\n\n\tvar channels = convert[model].channels;\n\n\t// conversion methods\n\tColor.prototype[model] = function () {\n\t\tif (this.model === model) {\n\t\t\treturn new Color(this);\n\t\t}\n\n\t\tif (arguments.length) {\n\t\t\treturn new Color(arguments, model);\n\t\t}\n\n\t\tvar newAlpha = typeof arguments[channels] === 'number' ? channels : this.valpha;\n\t\treturn new Color(assertArray(convert[this.model][model].raw(this.color)).concat(newAlpha), model);\n\t};\n\n\t// 'static' construction methods\n\tColor[model] = function (color) {\n\t\tif (typeof color === 'number') {\n\t\t\tcolor = zeroArray(_slice.call(arguments), channels);\n\t\t}\n\t\treturn new Color(color, model);\n\t};\n});\n\nfunction roundTo(num, places) {\n\treturn Number(num.toFixed(places));\n}\n\nfunction roundToPlace(places) {\n\treturn function (num) {\n\t\treturn roundTo(num, places);\n\t};\n}\n\nfunction getset(model, channel, modifier) {\n\tmodel = Array.isArray(model) ? model : [model];\n\n\tmodel.forEach(function (m) {\n\t\t(limiters[m] || (limiters[m] = []))[channel] = modifier;\n\t});\n\n\tmodel = model[0];\n\n\treturn function (val) {\n\t\tvar result;\n\n\t\tif (arguments.length) {\n\t\t\tif (modifier) {\n\t\t\t\tval = modifier(val);\n\t\t\t}\n\n\t\t\tresult = this[model]();\n\t\t\tresult.color[channel] = val;\n\t\t\treturn result;\n\t\t}\n\n\t\tresult = this[model]().color[channel];\n\t\tif (modifier) {\n\t\t\tresult = modifier(result);\n\t\t}\n\n\t\treturn result;\n\t};\n}\n\nfunction maxfn(max) {\n\treturn function (v) {\n\t\treturn Math.max(0, Math.min(max, v));\n\t};\n}\n\nfunction assertArray(val) {\n\treturn Array.isArray(val) ? val : [val];\n}\n\nfunction zeroArray(arr, length) {\n\tfor (var i = 0; i < length; i++) {\n\t\tif (typeof arr[i] !== 'number') {\n\t\t\tarr[i] = 0;\n\t\t}\n\t}\n\n\treturn arr;\n}\n\nmodule.exports = Color;\n","module.exports = function isArrayish(obj) {\n\tif (!obj || typeof obj === 'string') {\n\t\treturn false;\n\t}\n\n\treturn obj instanceof Array || Array.isArray(obj) ||\n\t\t(obj.length >= 0 && (obj.splice instanceof Function ||\n\t\t\t(Object.getOwnPropertyDescriptor(obj, (obj.length - 1)) && obj.constructor.name !== 'String')));\n};\n","'use strict';\n\nvar isArrayish = require('is-arrayish');\n\nvar concat = Array.prototype.concat;\nvar slice = Array.prototype.slice;\n\nvar swizzle = module.exports = function swizzle(args) {\n\tvar results = [];\n\n\tfor (var i = 0, len = args.length; i < len; i++) {\n\t\tvar arg = args[i];\n\n\t\tif (isArrayish(arg)) {\n\t\t\t// http://jsperf.com/javascript-array-concat-vs-push/98\n\t\t\tresults = concat.call(results, slice.call(arg));\n\t\t} else {\n\t\t\tresults.push(arg);\n\t\t}\n\t}\n\n\treturn results;\n};\n\nswizzle.wrap = function (fn) {\n\treturn function () {\n\t\treturn fn(swizzle(arguments));\n\t};\n};\n","/**\n * @name 需要判断位置的背景节点堆栈\n *\n * @class BgNodeStack\n *\n * @constructor\n * @param {Object} config Darkmode配置\n * @param {string} prefix 类名前缀\n *\n * @method push 背景节点入栈\n * @param {Dom Object} el    背景节点对象\n * @param {string}     cssKV css键值对\n *\n * @method contains 判断节点是否在背景节点的区域\n * @param {Dom Object} el       要判断的节点对象（非背景节点）\n * @param {function}   callback 如果在背景节点区域内，则执行该回调函数\n *\n * @method update 更新堆栈的节点对象，主要解决前后节点不一致的问题\n * @param {Dom Object Array} nodes 要更新的节点对象列表\n *\n */\n\nexport default class BgNodeStack {\n  _stack = []; // 需要判断位置的背景堆栈，{ el, className, cssKV, updated, rect }\n  _idx = 0; // 索引值\n\n  constructor(config, prefix) {\n    this._config = config;\n    this._prefix = prefix;\n  }\n\n  push(el, cssKV) {\n    const className = `${this._prefix}${this._idx++}`;\n    el.classList.add(className);\n    this._stack.unshift({\n      el,\n      className,\n      cssKV,\n      updated: !this._config.delayBgJudge\n    });\n  }\n\n  contains(el, callback) {\n    const rect = el.getBoundingClientRect();\n    const idxStack = [];\n\n    this._stack.forEach((item, i) => {\n      if (item.updated) {\n        if (!item.rect) item.rect = item.el.getBoundingClientRect();\n\n        const bgRect = item.rect;\n        if (!(rect.top >= bgRect.bottom || rect.bottom <= bgRect.top || rect.left >= bgRect.right || rect.right <= bgRect.left)) { // 表示节点在背景图内\n          idxStack.unshift(i);\n        }\n      }\n    });\n\n    while (idxStack.length) {\n      const item = this._stack.splice(idxStack.shift(), 1)[0];\n      typeof callback === 'function' && callback(item);\n    }\n  }\n\n  update(nodes) {\n    this._stack.forEach(item => {\n      if (!item.updated) {\n        Array.prototype.some.call(nodes, node => {\n          if (node.classList.contains(item.className)) {\n            item.el = node;\n            item.updated = true;\n            return true;\n          }\n          return false;\n        });\n      }\n    });\n  }\n};","export const MEDIA_QUERY = '(prefers-color-scheme: dark)'; // Dark Mode的CSS媒体查询\n\nexport const CLASS_PREFIX = 'js_darkmode__'; // Dark Mode class前缀\n\nexport const HTML_CLASS = 'data_color_scheme_dark'; // 强制设置暗黑模式时给html加的class\n\nconst RANDOM = `${new Date() * 1}${Math.round(Math.random() * 10)}`; // 生成个随机数，格式为时间戳+随机数\nexport const COLORATTR = `data-darkmode-color-${RANDOM}`;\nexport const BGCOLORATTR = `data-darkmode-bgcolor-${RANDOM}`;\nexport const ORIGINAL_COLORATTR = `data-darkmode-original-color-${RANDOM}`;\nexport const ORIGINAL_BGCOLORATTR = `data-darkmode-original-bgcolor-${RANDOM}`;\nexport const BGIMAGEATTR = `data-darkmode-bgimage-${RANDOM}`;\n\nexport const TEXTCOLOR = 'rgba(0,0,0,0.9)'; // 非Dark Mode下字体颜色\nexport const DEFAULT_DARK_BGCOLOR = '#232323'; // Dark Mode下背景颜色\nexport const DEFAULT_LIGHT_BGCOLOR = '#fff'; // 非Dark Mode下背景颜色\n\nexport const DEFAULT_DARK_BGCOLOR_BRIGHTNESS = 35;\nexport const LIMIT_LOW_BGCOLOR_BRIGHTNESS = 60;\n\nexport const PAGE_HEIGHT = (window.getInnerHeight && window.getInnerHeight()) || window.innerHeight || document.documentElement.clientHeight;\n\nexport const TABLE_NAME = ['TABLE', 'TR', 'TD', 'TH']; // 支持bgcolor属性的table标签列表\n\nconst UA = navigator.userAgent;\nexport const IS_PC = (/windows\\snt/i.test(UA) && !/Windows\\sPhone/i.test(UA)) || (/mac\\sos/i.test(UA) && !/(iPhone|iPad|iPod|iOS)/i.test(UA));","/**\n * @name 样式相关操作工具对象\n *\n * @class CssUtils\n *\n * @constructor\n * @param {Object} config Darkmode配置\n *\n * @attr {boolean} isFinish 是否运行过Dark Mode处理逻辑（写入过非首屏样式表则表示已运行过）\n *\n * @method genCssKV 生成css键值对\n * @param {string} key css属性\n * @param {string} val css值\n * @returns {string} css键值对\n *\n * @method genCss 生成css，包括css选择器\n * @param {string} className DOM节点类名\n * @param {string} cssKV     css键值对\n * @returns {string} css\n *\n * @method addCss 加入css\n * @param {string}  css              css样式\n * @param {boolean} isFirstPageStyle 是否首屏样式\n *\n * @method writeStyle 写入样式表\n * @param {boolean} isFirstPageStyle 是否首屏样式\n *\n */\n\nimport {\n  MEDIA_QUERY,\n  HTML_CLASS,\n} from './constant';\n\nexport default class CssUtils {\n  _firstPageStyle = ''; // 首屏样式\n  _otherPageStyle = ''; // 非首屏样式\n\n  isFinish = false;\n\n  constructor(config) {\n    this._config = config;\n  }\n\n  genCssKV(key, val) {\n    return `${key}: ${val} !important;`;\n  }\n\n  genCss(className, cssKV) {\n    return `${this._config.mode === 'dark' ? `html.${HTML_CLASS} ` : ''}.${className}{${cssKV}}`;\n  }\n\n  addCss(css, isFirstPageStyle) {\n    this[isFirstPageStyle ? '_firstPageStyle' : '_otherPageStyle'] += css;\n  }\n\n  writeStyle(isFirstPageStyle) {\n    let styleKey = '';\n\n    if (!isFirstPageStyle) { // 如果是写入非首屏样式表，则连同首屏样式一起写入\n      this._otherPageStyle = this._firstPageStyle + this._otherPageStyle;\n      this._firstPageStyle = '';\n      styleKey = '_otherPageStyle';\n      this.isFinish = true;\n    } else {\n      styleKey = '_firstPageStyle';\n    }\n\n    const style = this[styleKey];\n\n    if (style) {\n      document.head.insertAdjacentHTML('beforeend', `<style type=\"text/css\">${this._config.mode === 'dark' ? style : `@media ${MEDIA_QUERY} {${style}}`}</style>`);\n      this[styleKey] = ''; // 写入样式表后清空内存中的数据\n    }\n  }\n};","/**\n * @name 节点相关操作工具API\n *\n * @function getChildrenAndIt 获取某个节点及它的所有子节点\n * @param {Dom Object} dom 节点对象\n * @returns {Dom Object Array} 节点对象列表\n *\n * @function hasTextNode 判断某个节点里是否包含文字节点\n * @param {Dom Object} dom 节点对象\n * @returns {boolean} 判断结果\n *\n * @function hasTableClass 判断table相关元素有没有指定class\n * @param {Dom Object} dom 节点对象\n * @returns {string | null} 判断结果，如果有，返回class对应的lm色值，否则返回null\n *\n */\n\nexport function getChildrenAndIt(dom) {\n  return [dom].concat(...dom.querySelectorAll('*'));\n};\n\nexport function hasTextNode(dom) {\n  let cnt = '';\n  dom.childNodes.forEach(node => {\n    if (node.nodeType === 3) {\n      cnt += node.nodeValue.replace(/\\s/g, ''); // 不考虑空白字符\n    }\n  });\n  return cnt.length > 0;\n};\n\n// table的内部样式类对应的lm背景色\nconst tableClassObj = {\n  'ue-table-interlace-color-single': '#fcfcfc',\n  'ue-table-interlace-color-double': '#f7faff'\n};\nexport function hasTableClass(dom) {\n  let color = null;\n\n  Array.prototype.some.call(dom.classList, className => {\n    if (tableClassObj[className]) {\n      color = tableClassObj[className];\n      return true;\n    }\n    return false;\n  });\n\n  return color;\n};\n\n/**\n * @name 节点相关操作工具对象\n *\n * @class DomUtils\n *\n * @constructor\n * @param {Object} config Darkmode配置\n *\n * @method set 设置要处理的节点列表\n * @param {Dom Object Array} nodes 要处理的节点列表\n *\n * @method len 获取要处理的节点列表长度\n * @returns {number} 长度\n *\n * @method get 获取要处理的节点列表长度（包含延迟节点、容器节点等逻辑）\n * @returns {Dom Object Array} 要处理的节点列表\n *\n * @method delay 将所有要处理的节点转移到延迟处理队列里\n *\n * @method addFirstPageNode 添加首屏节点\n * @param {Dom Object} node 要添加的首屏节点\n *\n * @method showFirstPageNodes 显示所有首屏节点\n *\n */\n\nexport class DomUtils {\n  _nodes = []; // 要处理的节点列表\n  _firstPageNodes = []; // 首屏节点列表\n  _delayNodes = []; // 延迟处理的节点列表\n\n  constructor(config) {\n    this._config = config;\n  }\n\n  set(nodes = []) {\n    this._nodes = nodes;\n  }\n\n  len() {\n    return this._nodes.length;\n  }\n\n  get() {\n    let res = [];\n\n    if (this._nodes.length) { // 有节点\n      res = this._nodes;\n      this._nodes = [];\n    } else { // 如果没有节点\n      if (this._delayNodes.length) { // 有延迟节点，则使用延迟节点\n        res = this._delayNodes;\n        this._delayNodes = [];\n      } else if (this._config.container) { // 没有延迟节点，但有容器，重新获取容器内的节点\n        res = this._config.container.querySelectorAll('*');\n      }\n    }\n\n    return res;\n  }\n\n  delay() {\n    this._nodes.forEach(node => this._delayNodes.push(node)); // 转移到延迟处理的节点里\n    this._nodes = []; // 转移后清空列表\n  }\n\n  addFirstPageNode(node) {\n    this._firstPageNodes.push(node);\n  }\n\n  showFirstPageNodes() {\n    this._firstPageNodes.forEach(node => node.style.visibility = 'visible'); // 显示首屏节点\n    this._firstPageNodes = []; // 处理完之后清空列表\n  }\n};","/**\n * @name 算法SDK\n *\n * @class SDK\n *\n * @constructor\n * @param {Object} obj\n * @param {Object} obj.config   Darkmode配置\n * @param {Object} obj.tnQueue  文本队列\n * @param {Object} obj.bgStack  背景堆栈\n * @param {Object} obj.cssUtils 样式工具\n *\n * @method convert 处理节点\n * @param {DOM Object} el 要处理的节点\n * @returns {string} 处理后的css，包含css选择器\n *\n */\n\n// dependencies\nimport Color from 'color';\nimport ColorName from 'color-name';\nColorName.windowtext = [0, 0, 0]; // 补上这个colorName\nconst colorNameReg = new RegExp(Object.keys(ColorName).join('|'), 'ig'); // 生成正则表达式来匹配这些colorName\n\nimport {\n  CLASS_PREFIX,\n\n  COLORATTR,\n  BGCOLORATTR,\n  ORIGINAL_COLORATTR,\n  ORIGINAL_BGCOLORATTR,\n  BGIMAGEATTR,\n\n  TEXTCOLOR,\n  DEFAULT_DARK_BGCOLOR,\n  DEFAULT_LIGHT_BGCOLOR,\n\n  DEFAULT_DARK_BGCOLOR_BRIGHTNESS,\n  LIMIT_LOW_BGCOLOR_BRIGHTNESS,\n\n  TABLE_NAME,\n\n  IS_PC\n} from './constant';\n\n// 节点相关操作工具API\nimport {\n  getChildrenAndIt,\n  hasTextNode,\n  hasTableClass\n} from './domUtils';\n\nexport default class SDK {\n  _idx = 0; // 索引值\n\n  constructor({\n    config,\n    tnQueue,\n    bgStack,\n    cssUtils\n  }) {\n    this._config = config;\n    this._tnQueue = tnQueue;\n    this._bgStack = bgStack;\n    this._cssUtils = cssUtils;\n  }\n\n  // 调整明度\n  _adjustBrightness(color, el, options) {\n    // 背景：\n    // 处理原则：白背景改黑，其他高感知亮度背景调暗，低亮度适当提高亮度（感知亮度：https://www.w3.org/TR/AERT/#color-contrast）\n    // 处理方法：黑白灰色（h=0，s=0）亮度大于40%时，做取反处理（darkmode默认底色亮度为14%）；感知亮度大于190，取190；其他亮度小于26%时，设为26%。\n    // 遗留问题：高亮度背景高亮度字体有些case有问题（使用感知亮度算法解决大部分case）\n\n    // 字体、边框：\n    // 处理原则：高亮度字体压字体亮度(白色除外)，低亮度字体调亮（补充优化：带背景图片子元素字体颜色不变，带高感知亮度背景颜色子元素字体颜色不变），带背景图片字体补底色\n    // 处理方法：亮度小于40%时，用（90%-该亮度），大于等于40%则保持不变；\n\n    // 阴影\n    // 处理原则：不转换\n\n    // 原则：\n    // - 用户设置为高亮字体颜色（接近白色亮度），不处理，保持高亮\n    // - 用户设置的其他字体颜色，无背景颜色，低于感知亮度阈值提高感知亮度\n    // - 用户设置的其他字体颜色，有背景颜色，根据调整后的背景颜色算出具有一定亮度差的字体颜色\n    // - 用户设置了背景图片的字体颜色，暂不处理，不知道背景图片是量还是暗？？\n\n    const hsl = color.hsl().array();\n    const alpha = color.alpha();\n    const whiteColorBrightness = 250;\n    const limitBright = 190;\n    const limitLowTextBright = 75;\n    const LimitOffsetBrightness = 60;\n    let rgb = color.rgb().array();\n    let perceivedBrightness = (rgb[0] * 299 + rgb[1] * 587 + rgb[2] * 114) / 1000; // 计算感知亮度\n    let newColor;\n    let extStyle = '';\n\n    if (options.isBgColor) { // 背景色\n      // 如果设置背景颜色，取消背景图片的影响\n      if (el.getAttribute(BGIMAGEATTR) && alpha >= 0.05) {\n        el.removeAttribute(BGIMAGEATTR);\n      }\n\n      if ((hsl[1] === 0 && hsl[2] > 40) || perceivedBrightness > whiteColorBrightness) {\n        // 饱和度为0（黑白灰色），亮度大于40%或感知亮度大于250（白色）时，做亮度取反处理（Dark Mode 默认底色亮度为14%）\n        newColor = Color.hsl(0, 0, Math.min(100, 100 + 14 - hsl[2]));\n        // console.info('[背景] 白改黑，感知亮度%d：%c  测试  %c  测试  ', perceivedBrightness, `color:#fff;background:rgb(${rgb});`, `color:#fff;background:hsl(${hsl[0]},${hsl[1]}%,${hsl[2]}%)`);\n      } else if (perceivedBrightness > limitBright) {\n        // 感知亮度大于limitBright，将感知亮度设为limitBright\n        const ratio = (limitBright * 1000) / (rgb[0] * 299 + rgb[1] * 587 + rgb[2] * 114);\n        newColor = Color.rgb(rgb[0] * ratio, rgb[1] * ratio, rgb[2] * ratio);\n        // console.info('[背景] 调暗，感知亮度%d：%c  测试  %c  测试  ', perceivedBrightness, `color:#fff;background:rgb(${rgb});`, `color:#fff;background:rgb(${rgb[0] * ratio},${rgb[1] * ratio},${rgb[2] * ratio})`);\n      } else if (hsl[2] < 26) {\n        // 亮度小于26%，将亮度设为26%，适当提高亮度\n        hsl[2] = 26;\n        newColor = Color.hsl(...hsl);\n        // console.info('[背景] 调亮，感知亮度%d：%c  测试  %c  测试  ', perceivedBrightness, `color:#fff;background:rgb(${rgb});`, `color:#fff;background:hsl(${hsl[0]},${hsl[1]}%,${hsl[2]}%)`);\n      }\n\n      if (!options.hasInlineColor) {\n        const parentTextColor = el.getAttribute(COLORATTR) || TEXTCOLOR;\n        const parentBgColorStr = newColor || color;\n        // el.setAttribute(BGCOLORATTR, newColor || color)\n        const ret = this._adjustBrightness(Color(parentTextColor), el, {\n          isTextColor: true,\n          parentElementBgColorStr: parentBgColorStr\n        });\n        if (ret.newColor) {\n          extStyle += this._cssUtils.genCssKV('color', ret.newColor);\n        } else {\n          extStyle += this._cssUtils.genCssKV('color', parentTextColor);\n        }\n      }\n    } else if (options.isTextColor || options.isBorderColor) { // 字体色、边框色\n      const parentElementBgColorStr = options.parentElementBgColorStr || el.getAttribute(BGCOLORATTR) || DEFAULT_DARK_BGCOLOR;\n      const parentElementBgColor = Color(parentElementBgColorStr);\n      const parentElementBgColorRgb = parentElementBgColor.rgb().array();\n      const parentElementBgColorHSL = parentElementBgColor.hsl().array();\n      const parentElementBgColorAlpha = parentElementBgColor.alpha();\n      const parentElementBGPerceivedBrightness = (parentElementBgColorRgb[0] * 299 + parentElementBgColorRgb[1] * 587 + parentElementBgColorRgb[2] * 114) / 1000;\n      const parentElementBGWithOpacityPerceivedBrightness = parentElementBGPerceivedBrightness * parentElementBgColorAlpha + DEFAULT_DARK_BGCOLOR_BRIGHTNESS * (1 - parentElementBgColorAlpha);\n      const adjustTextBrightnessByLimitBrightness = (rgbArray, limitLowBright) => {\n        if (rgbArray[0] === 0 && rgbArray[1] === 0 && rgbArray[2] === 0) return Color.rgb(...rgbArray);\n        const relativeBrightnessRatio = (limitLowBright * 1000) / (rgbArray[0] * 299 + rgbArray[1] * 587 + rgbArray[2] * 114);\n        let newTextR = Math.min(255, rgbArray[0] * relativeBrightnessRatio);\n        let newTextG = Math.min(255, rgbArray[1] * relativeBrightnessRatio);\n        let newTextB = Math.min(255, rgbArray[2] * relativeBrightnessRatio);\n\n        if (newTextG === 0) {\n          newTextG = (limitLowBright * 1000 - newTextR * 299 - newTextB * 114) / 587;\n        } else if (newTextR === 0) {\n          newTextR = (limitLowBright * 1000 - newTextG * 587 - newTextB * 114) / 299;\n        } else if (newTextB === 0) {\n          newTextB = (limitLowBright * 1000 - newTextR * 299 - newTextG * 587) / 114;\n        } else if (newTextR === 255 || newTextB === 255) {\n          newTextG = (limitLowBright * 1000 - newTextR * 299 - newTextB * 114) / 587;\n        } else if (newTextG === 255) {\n          newTextB = (limitLowBright * 1000 - newTextR * 299 - newTextG * 587) / 114;\n        }\n        return Color.rgb(newTextR, newTextG, newTextB);\n      };\n\n      // 无背景图片\n      if (!el.getAttribute(BGIMAGEATTR)) {\n        // 用户设置为高亮字体颜色（接近白色亮度），不处理，保持高亮\n        if (perceivedBrightness >= whiteColorBrightness) {\n          // el.style.outline = '1px solid yellow';\n        } else if (parentElementBGWithOpacityPerceivedBrightness <= LIMIT_LOW_BGCOLOR_BRIGHTNESS && perceivedBrightness < limitLowTextBright) {\n          // 用户设置的其他字体颜色，无背景颜色或有低于阈值的背景颜色，低于感知亮度阈值的字体颜色提高感知亮度\n          if (hsl[2] <= 40) {\n            hsl[2] = 90 - hsl[2];\n            rgb = Color.hsl(...hsl).rgb().array();\n            perceivedBrightness = (rgb[0] * 299 + rgb[1] * 587 + rgb[2] * 114) / 1000;\n          }\n\n          if (perceivedBrightness >= limitLowTextBright) {\n            // el.style.outline = '1px solid red';\n            newColor = Color.hsl(...hsl);\n          } else {\n            newColor = adjustTextBrightnessByLimitBrightness(rgb, limitLowTextBright);\n          }\n        } else {\n          // 用户设置的其他字体颜色，有高于阈值感知亮度背景颜色，根据调整后的背景颜色算出具有一定亮度差的字体颜色\n          const offsetPerceivedBrightness = Math.abs(parentElementBGWithOpacityPerceivedBrightness - perceivedBrightness);\n          if (offsetPerceivedBrightness < LimitOffsetBrightness) {\n            if (parentElementBGWithOpacityPerceivedBrightness > 100) {\n              hsl[2] = 90 - hsl[2];\n              let tmpRgb = Color.hsl(...hsl).rgb().array();\n              let tmpPerceivedBrightness = (tmpRgb[0] * 299 + tmpRgb[1] * 587 + tmpRgb[2] * 114) / 1000;\n              // 先以最小改动来修复这里的问题，后面再整理代码\n              if (parentElementBGWithOpacityPerceivedBrightness - tmpPerceivedBrightness < LimitOffsetBrightness) {\n                // console.log(Math.abs(parentElementBGWithOpacityPerceivedBrightness - tmpPerceivedBrightness), el);\n                newColor = adjustTextBrightnessByLimitBrightness(tmpRgb, parentElementBGWithOpacityPerceivedBrightness - LimitOffsetBrightness);\n              } else {\n                newColor = Color.hsl(...hsl);\n              }\n            } else {\n              hsl[2] = parentElementBgColorHSL[2] + 40;\n              newColor = Color.hsl(...hsl);\n            }\n            // el.style.outline = '1px solid yellow';\n            // newColor = Color.hsl(...hsl);\n          }\n        }\n      }\n    }\n    return {\n      newColor: newColor && newColor.alpha(alpha).rgb(),\n      extStyle\n    };\n  }\n\n  convert(el) {\n    const nodeName = el.nodeName;\n\n    if (this._config.whitelist.tagName.indexOf(nodeName) > -1) return '';\n\n    const styles = el.style;\n    let cssKV = ''; // css键值对\n    let css = ''; // css\n\n    const isTable = TABLE_NAME.indexOf(nodeName) > -1;\n    let hasInlineColor = false; // 是否有自定义字体颜色\n    let hasInlineBackground = false;\n    let hasInlineBackgroundImage = false;\n    let elBackgroundPositionAttr;\n    let elBackgroundSizeAttr;\n    // let hasNegativeMarginsAttr = false; // margin, margin-left, margin-top, margin-right, margin-bottom\n    // let hasNewCSSStackingContextAttr = false; // opacity<1, transforms, filters\n    // let isJSSetNewCSSStackingContextAttr = false;\n\n    // styles.cssText 读出来的颜色统一是rgba格式，除了用英文定义颜色（如：black、white）\n    const cssKVList = (styles.cssText && styles.cssText.split(';') || []).map(cssStr => { // 将cssStr转换为[key, value]，并清除各个元素的前后空白字符\n      const splitIdx = cssStr.indexOf(':');\n      return [cssStr.slice(0, splitIdx).toLowerCase(), cssStr.slice(splitIdx + 1)].map(item => (item || '').replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, ''));\n    }).filter(([key, value]) => {\n      if (key === 'color') {\n        hasInlineColor = true;\n      } else if (/background/i.test(key)) {\n        hasInlineBackground = true;\n        if (key === 'background-position') {\n          elBackgroundPositionAttr = value;\n        } else if (key === 'background-size') {\n          elBackgroundSizeAttr = value;\n        }\n        // } else if ((key === 'opacity' && value < 1) || key === 'transform' || key === 'filter') {\n        //   hasNewCSSStackingContextAttr = true;\n        // } else if (/margin/i.test(key) && /-/.test(value)) {\n        //   hasNegativeMarginsAttr = true;\n      }\n\n      if ((/background/i.test(key) || /^(-webkit-)?border-image/.test(key)) && /url\\([^\\)]*\\)/i.test(value)) {\n        hasInlineBackgroundImage = true;\n      }\n\n      // 过滤掉一些key\n      return [\n        '-webkit-border-image',\n        'border-image',\n        'color',\n        'background-color',\n        'background-image',\n        'background',\n        'border',\n        'border-top',\n        'border-right',\n        'border-bottom',\n        'border-left',\n        'border-color',\n        'border-top-color',\n        'border-right-color',\n        'border-bottom-color',\n        'border-left-color'\n      ].indexOf(key) > -1;\n    }).sort(([key1], [key2]) => { // color属性放在最后\n      if (key1 === 'color') {\n        return 1;\n      } else if (key1 === 'background-image' && key2 === 'background-color') { // 确保 background-image 在 background-color 后面\n        return 1;\n      }\n      return -1;\n    });\n\n    if (isTable && !hasInlineBackground) { // 如果table没有内联样式\n      let color = hasTableClass(el); // 获取class对应的lm色值\n      if (!color) color = el.getAttribute('bgcolor'); // 如果没有class则获取bgcolor的色值\n      if (color) { // 有色值（class对应的lm色值或者是bgcolor色值），则当做内联样式来处理\n        cssKVList.unshift(['background-color', Color(color).toString()]);\n        hasInlineBackground = true;\n      }\n    }\n\n    cssKVList.forEach(([key, value]) => {\n      const oldValue = value;\n      let cssChange = false;\n\n      // !important\n      const importantReg = / !important$/;\n\n      // 将英文定义颜色转换为rgb格式\n      value = value.replace(importantReg, '').replace(colorNameReg, match => `rgb(${ColorName[match.toLowerCase()].toString()})`);\n\n      // 找出色值来处理\n      const colorReg = /rgba?\\([^)]+\\)/ig;\n      const isBgColor = /^background/.test(key);\n      const isTextColor = key === 'color';\n      const isBorderColor = /^border/.test(key);\n      const isGradient = /gradient/.test(value);\n      const mixColor = colors => {\n        if (!colors || colors.length < 1) return '';\n        if (colors.length === 1) return colors[0];\n\n        let retColor = colors.shift();\n        let nextColor = colors.pop();\n        while (nextColor) {\n          retColor = Color(retColor).mix(Color(nextColor));\n          nextColor = colors.pop();\n        }\n\n        return retColor;\n      };\n      let extStyle = '';\n      let gradientColors = [];\n      let gradientMixColor;\n\n      if (!hasInlineBackgroundImage && colorReg.test(value)) {\n        if (isGradient) {\n          // 把原渐变色取出来\n          value.replace(colorReg, match => gradientColors.push(match));\n\n          // 计算出一个mix原色\n          gradientMixColor = mixColor([].concat(gradientColors));\n          // console.log(value, gradientColors, 'mix:', gradientMixColor) ;\n        }\n        value = value.replace(colorReg, match => {\n          // 渐变色统一改成mix纯色\n          if (isGradient) {\n            match = gradientMixColor;\n            cssChange = true;\n          }\n\n          // 使用颜色处理算法\n          const ret = this._adjustBrightness(Color(match), el, {\n            isBgColor,\n            isTextColor,\n            isBorderColor,\n            hasInlineColor\n          });\n          const retColor = ret.newColor;\n\n          extStyle += ret.extStyle;\n\n          // 对背景颜色和文字颜色做继承传递，用于文字亮度计算\n          if (isBgColor || isTextColor) {\n            // isSetChildren = true;\n            const attrName = isBgColor ? BGCOLORATTR : COLORATTR;\n            const originalAttrName = isBgColor ? ORIGINAL_BGCOLORATTR : ORIGINAL_COLORATTR;\n            const retColorStr = retColor ? retColor.toString() : match;\n            getChildrenAndIt(el).forEach(dom => {\n              dom.setAttribute(attrName, retColorStr);\n              dom.setAttribute(originalAttrName, match);\n\n              // 如果设置背景颜色，取消背景图片的影响\n              if (isBgColor && Color(retColorStr).alpha() >= 0.05 && dom.getAttribute(BGIMAGEATTR)) {\n                dom.removeAttribute(BGIMAGEATTR);\n              }\n            });\n          }\n\n          retColor && (cssChange = true);\n\n          return retColor || match;\n        }).replace(/\\s?!\\s?important/ig, '');\n      }\n\n      if (extStyle) {\n        cssKV += extStyle;\n      }\n\n      if (!(el instanceof SVGElement)) { // 先不处理SVG\n        // 背景图片、边框图片\n        const isBackgroundAttr = /^background/.test(key);\n        const isBorderImageAttr = /^(-webkit-)?border-image/.test(key);\n        if ((isBackgroundAttr || isBorderImageAttr) && /url\\([^\\)]*\\)/i.test(value)) {\n          cssChange = true;\n          let imgBgColor = el.getAttribute(ORIGINAL_BGCOLORATTR) || DEFAULT_LIGHT_BGCOLOR;\n          const imgBgCover = 'rgba(0,0,0,0.1)';\n\n          // 在背景图片下加一层原背景颜色：\n          // background-image使用多层背景(注意background-position也要多加一层 https://www.w3.org/TR/css-backgrounds-3/#layering)；\n          // border-image不支持多层背景，需要添加background-color\n          value = value.replace(/^(.*?)url\\(([^\\)]*)\\)(.*)$/i, (matches) => {\n            let newValue = matches;\n            let newBackgroundPositionValue = '';\n            let newBackgroundSizeValue = '';\n            let tmpCssKvStr = '';\n\n            if (el.getAttribute(BGIMAGEATTR) !== '1') { // 避免重复setAttribute\n              getChildrenAndIt(el).forEach(dom => dom.setAttribute(BGIMAGEATTR, '1'));\n            }\n\n            // background-image\n            if (isBackgroundAttr) {\n              newValue = `linear-gradient(${imgBgCover}, ${imgBgCover}),${matches}`;\n              tmpCssKvStr = this._cssUtils.genCssKV(key, `${newValue},linear-gradient(${imgBgColor}, ${imgBgColor})`);\n              if (elBackgroundPositionAttr) {\n                newBackgroundPositionValue = `top left,${elBackgroundPositionAttr}`;\n                cssKV += this._cssUtils.genCssKV('background-position', `${newBackgroundPositionValue}`);\n                tmpCssKvStr += this._cssUtils.genCssKV('background-position', `${newBackgroundPositionValue},top left`);\n              }\n              if (elBackgroundSizeAttr) {\n                newBackgroundSizeValue = `100%,${elBackgroundSizeAttr}`;\n                cssKV += this._cssUtils.genCssKV('background-size', `${newBackgroundSizeValue}`);\n                tmpCssKvStr += this._cssUtils.genCssKV('background-size', `${newBackgroundSizeValue},100%`);\n              }\n              this._bgStack.push(el, tmpCssKvStr); // 背景图入栈\n            } else {\n              // border-image元素，如果当前元素没有背景颜色，补背景颜色\n              !hasInlineBackground && this._bgStack.push(el, this._cssUtils.genCssKV('background-image', `linear-gradient(${imgBgCover}, ${imgBgCover}),linear-gradient(${imgBgColor}, ${imgBgColor})`)); // 背景图入栈\n            }\n            return newValue;\n          });\n\n          // 没有设置自定义字体颜色，则使用非 Dark Mode 下默认字体颜色\n          if (!hasInlineColor) {\n            const textColor = el.getAttribute(ORIGINAL_COLORATTR) || TEXTCOLOR;\n            cssKV += this._cssUtils.genCssKV('color', textColor);\n            getChildrenAndIt(el).forEach(dom => dom.setAttribute(COLORATTR, textColor));\n          }\n        }\n      }\n\n      if (cssChange) {\n        importantReg.test(oldValue) && (styles[key] = oldValue.replace(importantReg, '')); // 清除inline style的!important\n        if (isGradient) {\n          this._bgStack.push(el, this._cssUtils.genCssKV(key, value)); // 渐变入栈\n        } else {\n          cssKV += this._cssUtils.genCssKV(key, value);\n        }\n      }\n    });\n\n    // 问题：darkmode下为了降低图片亮度添加了filter，导致CSS渲染创建新的Stacking Contexts，影响节点层级\n    // 解决办法：层级遮挡问题只会出现在margin为负值的情况下，所以为这些节点创建新的Stacking Contexts来提升层级\n    // if (hasNegativeMarginsAttr === true && hasNewCSSStackingContextAttr === false && isJSSetNewCSSStackingContextAttr === false) {\n    //   cssKV += this._cssUtils.genCssKV('transform', 'translateX(0)');\n    //   isJSSetNewCSSStackingContextAttr = true;\n    // }\n\n    if (cssKV) { // 有处理过或者是背景图片就加class以及css\n      IS_PC && el.setAttribute('data-style', styles.cssText); // PC端备份内联样式到data-style里，供编辑器做反处理\n      const className = `${CLASS_PREFIX}${this._idx++}`;\n      el.classList.add(className);\n      css += (cssKV ? this._cssUtils.genCss(className, cssKV) : '');\n    }\n\n    if (hasTextNode(el)) { // 如果节点里有文本，要判断是否在背景图里\n      if (this._config.delayBgJudge) { // 延迟背景判断\n        this._tnQueue.push(el); // 文字入队\n      } else {\n        this._bgStack.contains(el, item => {\n          css += this._cssUtils.genCss(item.className, item.cssKV);\n        });\n      }\n    }\n\n    return css;\n  }\n};","/**\n * @name 文本节点队列\n *\n * @class TextNodeQueue\n *\n * @constructor\n * @param {Object} config Darkmode配置\n * @param {string} prefix 类名前缀\n *\n * @method push 文本节点入队\n * @param {Dom Object} el 文本节点对象\n *\n * @method forEach 遍历，遍历过的文本节点出队\n * @param {function} callback 回调\n *\n * @method update 更新队列的节点对象，主要解决前后节点不一致的问题\n * @param {Dom Object Array} nodes 要更新的节点对象列表\n *\n */\n\nexport default class TextNodeQueue {\n  _queue = []; // 文本节点队列，{ el, className, updated }\n  _idx = 0; // 索引值\n\n  constructor(config, prefix) {\n    this._config = config;\n    this._prefix = prefix;\n  }\n\n  push(el) {\n    const className = `${this._prefix}${this._idx++}`;\n    el.classList.add(className);\n    this._queue.push({\n      el,\n      className,\n      updated: !this._config.delayBgJudge\n    });\n  }\n\n  forEach(callback) {\n    const idxStack = [];\n\n    this._queue.forEach((item, idx) => {\n      if (item.updated) {\n        idxStack.unshift(idx);\n        typeof callback && callback(item.el);\n      }\n    });\n\n    while (idxStack.length) { // 处理完之后删除部分节点\n      this._queue.splice(idxStack.shift(), 1);\n    }\n  }\n\n  update(nodes) {\n    this._queue.forEach(item => {\n      if (!item.updated) {\n        Array.prototype.some.call(nodes, node => {\n          if (node.classList.contains(item.className)) {\n            item.el = node;\n            item.updated = true;\n            return true;\n          }\n          return false;\n        });\n      }\n    });\n  }\n};","/**\n * @name Darkmode主入口\n *\n * @function run 配置并处理\n * @param {Dom Object Array} nodes 要处理的节点列表\n * @param {Object}           opt   Dark Mode配置，详见init配置说明\n *\n * @function init 初始化Dark Mode配置\n * @param {Function}   opt.error              发生error时触发的回调\n * @param {String}     opt.mode               强制指定的颜色模式(dark|light), 指定了就不监听系统颜色\n * @param {Object}     opt.whitelist          节点白名单\n * @param {Array}      opt.whitelist.tagName  标签名列表\n * @param {Boolean}    opt.needJudgeFirstPage 是否需要判断首屏\n * @param {Boolean}    opt.delayBgJudge       是否延迟背景判断\n * @param {DOM Object} opt.container          延迟运行js时的容器\n *\n * @function convert 处理节点\n * @param {Dom Object Array} nodes 要处理的节点列表\n * @param {Boolean}          force 是否强制运行\n *\n * @function convertBg 处理背景\n * @param {Dom Object Array} nodes 要处理的节点列表\n * @param {Boolean}          force 是否强制运行\n *\n */\n\nimport {\n  MEDIA_QUERY,\n\n  CLASS_PREFIX,\n\n  PAGE_HEIGHT\n} from './common/constant';\nconst classReg = new RegExp(`${CLASS_PREFIX}[^ ]+`, 'g');\n\n// Darkmode配置\nconst config = {\n  error: null, // 发生error时触发的回调\n  mode: '', // 强制指定的颜色模式(dark|light), 指定了就不监听系统颜色\n  whitelist: { // 节点白名单\n    tagName: ['MPCPS', 'IFRAME'] // 标签名列表\n  },\n  needJudgeFirstPage: true, // 需要判断首屏\n  delayBgJudge: false, // 是否延迟背景判断\n  container: null // 延迟运行js时的容器\n};\n\n// 文本节点队列\nimport TextNodeQueue from './common/textNodeQueue';\nconst tnQueue = new TextNodeQueue(config, `${CLASS_PREFIX}text__`);\n\n// 需要判断位置的背景节点堆栈\nimport BgNodeStack from './common/bgNodeStack';\nconst bgStack = new BgNodeStack(config, `${CLASS_PREFIX}bg__`);\n\n// 样式相关操作工具对象\nimport CssUtils from './common/cssUtils';\nconst cssUtils = new CssUtils(config);\n\n// 节点相关操作工具对象\nimport {\n  DomUtils\n} from './common/domUtils';\nconst domUtils = new DomUtils(config);\n\nimport SDK from './common/sdk';\nconst sdk = new SDK({\n  config,\n  tnQueue,\n  bgStack,\n  cssUtils\n});\n\n// Dark Mode切换\nlet mql = null;\nconst switchToDarkmode = (mqlObj, opt = {\n  type: 'dom'\n}) => {\n  opt.force && (cssUtils.isFinish = false); // 如果是强制运行Dark Mode处理逻辑，则重置为未运行\n\n  if (cssUtils.isFinish) return; // 已运行过Dark Mode处理逻辑则不再运行\n\n  try {\n    if (cssUtils.mode ? (cssUtils.mode === 'dark') : mqlObj.matches) { // Dark Mode\n      if (opt.type === 'dom') { // 处理节点\n        domUtils.get().forEach(node => {\n          if (node.className && typeof node.className === 'string') {\n            node.className = node.className.replace(classReg, ''); // 过滤掉原有的Dark Mode class，避免外部复制文章时把文章内的Dark Mode class也复制过去导致新文章在Dark Mode下样式错乱\n          }\n\n          if (!config.needJudgeFirstPage) { // 不需要判断首屏\n            cssUtils.addCss(sdk.convert(node), false); // 写入非首屏样式\n          } else { // 判断首屏\n            const rect = node.getBoundingClientRect();\n            const top = rect.top;\n            const bottom = rect.bottom;\n            if (top <= 0 && bottom <= 0) { // 首屏前面\n              cssUtils.addCss(sdk.convert(node), false); // 写入非首屏样式\n            } else if ((top > 0 && top < PAGE_HEIGHT) || (bottom > 0 && bottom < PAGE_HEIGHT)) { // 首屏\n              domUtils.addFirstPageNode(node); // 记录首屏节点\n              cssUtils.addCss(sdk.convert(node), true); // 写入首屏样式\n            } else { // 首屏后面，理论上，这里最多只会进来一次\n              config.needJudgeFirstPage = false; // 至此，不需要再判断首屏了\n\n              // 显示首屏\n              cssUtils.writeStyle(true); // 写入首屏样式表\n              domUtils.showFirstPageNodes(); // 显示首屏节点\n\n              cssUtils.addCss(sdk.convert(node), false); // 写入非首屏样式\n            }\n          }\n        });\n      } else if (opt.type === 'bg') { // 处理背景\n        tnQueue.forEach(text => bgStack.contains(text, bg => {\n          cssUtils.addCss(cssUtils.genCss(bg.className, bg.cssKV), false); // 写入非首屏样式\n        }));\n      }\n    } else {\n      // 首次加载页面时为非Dark Mode，标记为不需要判断首屏\n      config.needJudgeFirstPage = false;\n\n      // 首次加载页面时为非Dark Mode，标记为不延迟判断背景\n      config.delayBgJudge = false;\n\n      if (config.container === null && opt.type === 'dom' && domUtils.len()) {\n        domUtils.delay(); // 将节点转移到延迟处理队列里\n      }\n    }\n\n    cssUtils.writeStyle(); // 写入非首屏样式表\n  } catch (e) {\n    console.error(e);\n    typeof config.error === 'function' && config.error(e);\n  }\n};\n\nexport function run(nodes, opt) {\n  init(opt); // 初始化\n  convert(nodes); // 处理\n};\n\nexport function init(opt = {}) {\n  opt = JSON.parse(JSON.stringify(opt)); // 简单深复制一下\n\n  const whitelist = opt.whitelist || {};\n  delete opt.whitelist;\n\n  Object.assign(config, opt);\n\n  // 无重复追加whitelist.tagName\n  const tagName = config.whitelist.tagName;\n  whitelist.tagName && whitelist.tagName.forEach(item => {\n    item = item.toUpperCase();\n    tagName.indexOf(item) === -1 && tagName.push(item);\n  });\n\n  if (!cssUtils.mode && mql === null) {\n    // 匹配媒体查询\n    mql = window.matchMedia(MEDIA_QUERY);\n    mql.addListener(switchToDarkmode); // 监听\n  }\n};\n\nexport function convert(nodes, force = false) {\n  domUtils.set(nodes);\n\n  switchToDarkmode(mql, {\n    force,\n    type: 'dom'\n  });\n};\n\nexport function convertBg(nodes, force = false) {\n  domUtils.set(nodes);\n\n  if (config.container !== null) {\n    bgStack.update(nodes); // 更新背景堆栈\n    tnQueue.update(nodes); // 更新文字队列\n  }\n\n  switchToDarkmode(mql, {\n    force,\n    type: 'bg'\n  });\n};"],"sourceRoot":""}